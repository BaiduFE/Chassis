var Router={routes:["info/:id","submit"]},IndexModel=Chassis.Model.extend({defaults:{page:1},url:function(){return"/?m=Index&a=recordlist&page="+this.get("page")},parse:function(a){return a}});Chassis.PageView.index=Chassis.PageView.extend({el:"#list",events:{"change model":"onModelChange","error model":"onModelError","click a.info":"gotoInfo","click .more":"more"},init:function(){this.model=new IndexModel,this.root.on("index:reload",this.reload),this.showLoading()},onBeforePageIn:function(){this.firstLoad||(this.firstLoad=!0,this.model.fetch())},onAfterPageIn:function(){this.$el.show(),this.hideLoading()},onModelChange:function(){this.model.get("totalPage")<=this.model.get("page")&&this.$el.find(".more").hide(),this.$el.find("ul").length?this.$el.find("ul").append(baidu.template($("#listtplitem").html(),this.model.toJSON())):this.$el.html(baidu.template($("#listtpl").html(),this.model.toJSON()))},onModelError:function(){this.$el.html("something is wrong")},gotoInfo:function(a){Chassis.history.navigate("info/"+$(a.target).attr("data-id"))},more:function(){this.model.set("page",this.model.get("page")+1,{silent:!0}),this.model.fetch()},reload:function(){console.log("#######"),this.model.set("page",1,{silent:!0}),this.model.fetch()}});var InfoModel=Chassis.Model.extend({url:function(){return"/?m=Index&a=recordinfo"},parse:function(a){return a}});Chassis.SubView.info_content_info=Chassis.SubView.extend({className:"infoItem",events:{"change model":"onModelChange","error model":"onModelError","click .submit":"submit"},init:function(a){this.id=a.id,this.model=new InfoModel},onBeforeSwitchIn:function(){var a=this;this.showLoading(),this.model.fetch({data:{id:a.id}})},onAfterSwitchIn:function(){this.hideLoading(),this.$el.show()},onModelChange:function(){this.$el.html(baidu.template($("#commentTpl").html(),this.model.toJSON()))},onModelError:function(){this.$el.html("something is wrong")},submit:function(){var a=this,b=a.$el.find("textarea[name=content]").val();$.ajax({url:"/?m=Index&a=addrecordcomment",type:"POST",data:$.param({id:a.id,content:b}),dataType:"json",success:function(){a.$el.html(baidu.template($("#submitSuccessTpl").html(),{}))},error:function(){}})}}),Chassis.SubView.info_content=Chassis.SubView.extend({el:"#info-content",init:function(){var a=this;a.spm=new Chassis.SubPageMgr({owner:a,max:15,klass:Chassis.SubView.info_content_info})},onBeforePageIn:function(){},onAfterPageIn:function(){this.$el.show()}}),Chassis.PageView.info=Chassis.PageView.extend({el:"#info",init:function(a){var b=this;b.setup(new Chassis.SubView.info_content(Chassis.mixin({},a),b))},onAfterPageIn:function(){this.$el.show()}}),Chassis.PageView.submit=Chassis.PageView.extend({el:"#submitElement",events:{"click .submit":"submit","click .goBack":"goBack","click .resetSubmit":"reset"},init:function(){},onBeforePageIn:function(){},onAfterPageIn:function(){return Config.haslogin?(this.$el.html(baidu.template($("#submitTpl").html(),{})),void 0):(this.$el.html(baidu.template($("#loginTip").html(),{})),void 0)},onModelChange:function(){},onModelError:function(){this.$el.html("something is wrong")},submit:function(){var a,b,c=this;a=this.$el.find("input[name=title]").val(),b=this.$el.find("input[name=url]").val(),$.ajax({url:"/?m=Index&a=addrecord",type:"POST",data:$.param({title:a,url:b}),dataType:"json",success:function(){c.$el.html(baidu.template($("#submitSuccessTpl").html(),{}))},error:function(){}})},goBack:function(){console.log(this.root),this.root.trigger("index:reload"),Chassis.history.navigate("")},reset:function(){this.$el.html(baidu.template($("#submitTpl").html(),{}))}}),Chassis.GlobalView.top=Chassis.GlobalView.extend({el:"#globalview-top",events:{"click #home":"gotoHome","click #submit":"gotoSubmit"},init:function(){var a=this,b=a.root;b.on("routechange",a.onRouteChange,a)},onBeforePageIn:function(){},onRouteChange:function(a){this._currentAction=a.to.action},gotoHome:function(){""!=this._currentAction&&Chassis.history.navigate("")},gotoSubmit:function(){"submit"!=this._currentAction&&Chassis.history.navigate("submit")}}),Chassis.View.Loading.setup(".wrapper .global-loading",".wrapper .page-loading"),Router=Chassis.Router.extend(Router);var router=new Router;new Chassis.GlobalView.top({},router),Chassis.history.start({pushState:!0,root:"/"});