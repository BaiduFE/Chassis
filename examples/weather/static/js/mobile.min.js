

Slider = function(e, t) {
    var n = $(e),
    r = n.find(".handle"),
    i = !1,
    s = !1,
    o,
    u,
    a,
    f,
    l = !1,
    c = 0,
    h = 0,
    p,
    d,
    v = t.change,
    m = t.start,
    g = t.stop,
    y = t.stop_animating_to,
    b = t.move_on_down == null ? !0 : t.move_on_down,
    w = t.max_speed != null ? t.max_speed: .35,
    E = t.speed_multiple != null ? t.speed_multiple: .01,
    S = t.stop_decay != null ? t.stop_decay: .004,
    x = t.snap_distance != null ? t.snap_distance: 50,
    T = function() {
        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
        function(e, t) {
            window.setTimeout(e, 11)
        }
    } (),
    N = function(e) {
        return e < 0 ? -1 : 1
    },
    C = function() {
        var e = (new Date).getTime(),
        t = e - d || 0;
        i || s ? (p = E * (a - c), Math.abs(p) > w && (p = N(p) * w)) : p *= Math.exp( - t * S),
        Math.abs(p) < .005 && (p = 0),
        c = Math.min(u, Math.max(0, c + p * t)),
        h = c / u,
        r.css("left", c),
        d = e,
        v && v(h),
        i || p != 0 ? T(C) : s && y ? (s = !1, y()) : g && g()
    },
    k = function(e) {
        e.stopPropagation(),
        e.preventDefault(),
        o = n.offset().left,
        u = n.width(),
        i = !0,
        l = !1;
        var t = e.touches || e.originalEvent.touches;
        f = a = (t ? t[0].pageX: e.clientX) - o,
        d = (new Date).getTime(),
        $touchmove_elem.unbind("mouseup", L),
        $touchmove_elem.unbind("touchend", L),
        $touchmove_elem.bind("mouseup", L),
        $touchmove_elem.bind("touchend", L),
        $touchmove_elem.unbind("mousemove", A),
        $touchmove_elem.unbind("touchmove", A),
        $touchmove_elem.bind("mousemove", A),
        $touchmove_elem.bind("touchmove", A),
        b && (Math.abs(c - a) > x ? (c = a, h = c / u, r.css("left", c), m && m(), v && v()) : m && m(), C())
    },
    L = function() {
        i = !1,
        $touchmove_elem.unbind("mouseup", L),
        $touchmove_elem.unbind("mousemove", A),
        $touchmove_elem.unbind("touchend", L),
        $touchmove_elem.unbind("touchmove", A),
        l || n.trigger("tap")
    },
    A = function(e) {
        e.preventDefault();
        var t = e.touches || e.originalEvent.touches;
        a = (t ? t[0].pageX: e.clientX) - o,
        !l && Math.abs(a - f) > 10 && (l = !0, n.trigger("start_move"), b || (m && m(), C()))
    },
    O = function(e) {
        h = e,
        c = h * n.width(),
        r.css("left", c)
    },
    M = function(e) {
        if (i) return;
        u == null && (u = n.width()),
        a = e * u,
        s = !0,
        C()
    };
    return n.bind("mousedown", k),
    n.bind("touchstart", k),
    $touchmove_elem = ENV.is_android ? n: $("body"),
    n.set_val = O,
    n.animate_to = M,
    n
},

Sidebar = function() {
    var e = {},
    t = $(e),
    n = $("#main"),
    r = n[0],
    i = $("#sidebar_grippy"),
    s = $("#sidebar"),
    o = 50,
    u = !1,
    a = 0,
    f = !1,
    l,
    c,
    h,
    p = function() {
        u ? i.css("height", $(window).height()) : i.css("height", $("#search_area").height())
    },
    d = function(e) {
        t.trigger("started_closing_sidebar");
        var n = e ? 200 : 150;
        translate_transition(r, n + "ms ease-out"),
        translate(r, 0, 0),
        u = !1,
        p(),
        setTimeout(function() {
            $("body").removeClass("sidebar_open").removeClass("sliding_main"),
            t.trigger("finished_closing_sidebar"),
            UIManager.start_wobble()
        },
        n)
    },
    v = function(e) {
        t.trigger("started_opening_sidebar"),
        $("body").addClass("sidebar_open");
        var n = e ? 200 : 250;
        translate_transition(r, n + "ms ease-out"),
        translate(r, $("body").width() - o, 0),
        u = !0,
        p(),
        setTimeout(function() {
            t.trigger("finished_opening_sidebar"),
            $("body").removeClass("sliding_main")
        },
        n)
    },
    m = function(e) {
        t.trigger("started_hiding_sidebar");
        var n = e ? 200 : 150;
        translate_transition(r, n + "ms ease-out"),
        translate(r, $("body").width(), 0),
        setTimeout(function() {
            t.trigger("finished_hiding_sidebar"),
            $("body").removeClass("sliding_main")
        },
        n)
    },
    g = function(t) {
        if (e.map_revealed) return;
        t.stopPropagation(),
        t.stopImmediatePropagation();
        var n = t.originalEvent.changedTouches[0].clientX - c;
        return l || (l = n),
        h = n < l ? -1 : 1,
        l = n,
        translate(r, Math.max(0, n), 0),
        !1
    },
    y,
    b;
    i.bind("touchstart",
    function(e) {
        return e.stopPropagation(),
        e.stopImmediatePropagation(),
        y = e.originalEvent.touches[0].pageX,
        b = e.originalEvent.touches[0].pageY,
        f = !0,
        l = null,
        h = null,
        UIManager.overview_icons.pause(),
        UIManager.stop_wobble(),
        c = e.originalEvent.changedTouches[0].clientX,
        u && (c -= $("body").width() - o),
        translate_transition(r, null),
        $("body").bind("touchmove", g).addClass("sliding_main"),
        !1
    }),
    i.bind("touchend",
    function(t) {
        f = !1,
        $("body").unbind("touchmove", g);
        if (e.map_revealed) return E();
        h ? h < 0 ? d(!0) : v(!0) : u ? d(!1) : y > $("body").width() - 90 ? w() : $("#search_area .refresh").is(":visible") && $.touching({
            x: y,
            y: 20
        },
        $("#search_area .refresh")).length ? $("#search_area .refresh").trigger("click") : v(!1)
    }),
    ENV.is_mobile && (s.bind("touchmove",
    function(e) {
        e.preventDefault()
    }), $("#forecast_form .clear").bind("click",
    function(e) {
        e.preventDefault(),
        e.stopPropagation(),
        e.stopImmediatePropagation(),
        $("#forecast_location_field").val("").focus()
    })),
    e.map_revealed = !1;
    var w = function() {
        t.trigger("reveal_map");
        var n = 350;
        $("#map_area").addClass("revealed"),
        $("#search_area").addClass("map"),
        translate_transition(r, n + "ms ease-out"),
        translate(r, 0, $(window).height() - $("#search_area").height()),
        e.map_revealed = !0,
        UIManager.overview_icons.pause(),
        UIManager.stop_wobble(),
        Map.load_animation()
    },
    E = function() {
        t.trigger("hide_map");
        var n = 350;
        Map.stop_animation(),
        UIManager.start_wobble(),
        UIManager.overview_icons.play(),
        $("#search_area").removeClass("map"),
        translate_transition(r, n + "ms ease-out"),
        translate(r, 0, 0),
        e.map_revealed = !1,
        setTimeout(function() {
            $("#map_area").removeClass("revealed")
        },
        n + 10)
    };
    return e.close_sidebar = d,
    e.open_sidebar = v,
    e.hide_sidebar = m,
    e.is_open = function() {
        return u
    },
    e
} (),

LocationManager = function() {
    var e = {},
    t = $(e);
    e.forecasts = [],
    e.use_current_location = !1;
    var n, r, i;
    e.blank_load = function() {
        var e = store.enabled && store.get("last_location");
        if (e && e.lat != null && e.lon != null) return t.trigger("location_updated", e);
        LocationManager.update_current_location(!0)
    },
    e.save_last_location = function(e) {
        if (!e.name || e.lat == null || e.lon == null) return;
        store.enabled && store.set("last_location", {
            name: e.name,
            lat: e.lat,
            lon: e.lon
        })
    },
    e.ip_geolocate = function(e) {
		i = $.ajax({
			url : 'http://hostip.duapp.com/ip.php',
			type : 'get',
			dataType : 'jsonp',
			success : function(t) {
				return t ? e(null, t) : e(new Error("Cannot IP geolocate"))
			}
		})
    },
    e.update_current_location = function(n) {
        if (!n) {
            e.use_current_location = !1,
            store.enabled && store.set("use_current_location", null);
            return
        }
        UIManager.page_loading(!ENV.is_mobile),
        i && i.abort();
        var r = function(n, r, i) {
            e.use_current_location = !0,
            store.enabled && store.set("use_current_location", !0),
            t.trigger("location_updated", {
                lat: n,
                lon: r,
                name: i || "Current Location"
            })
        },
        s = function() {
            e.use_current_location = !1,
            console.log("An error occurred. Your location could not be determined")
        },
        o = function() {
            e.ip_geolocate(function(e, t) {
                return e ? s() : r(t.latitude, t.longitude, t.name)
            })
        },
        u,
        a = !1;
        ENV.has_geolocation ? (a = !1, u = setTimeout(function() {
            a = !0,
            o()
        },
        5e3), setTimeout(function() {
            navigator.geolocation.getCurrentPosition(function(e) {
                clearTimeout(u);
                if (a) return;
                e && e.coords ? r(e.coords.latitude, e.coords.longitude) : o()
            },
            function() {
                clearTimeout(u);
                if (a) return;
                e.ip_geolocate(function(e, t) {
                    return e ? s() : r(t.latitude, t.longitude, t.name)
                })
            },
            {
                enableHighAccuracy: !0,
                timeout: 4500
            })
        },
        0)) : o()
    },
    e.get_saved_forecasts = function(t) {
        if (typeof t == "undefined") return e.forecasts;
        if (typeof t == "number") return e.forecasts[t]
    },
    e.add_location = function(t, n) {
        if (e.use_current_location && !n) return e.loc_for_lat_long(Forecaster.latitude, Forecaster.longitude, !0,
        function(n) {
            return e.add_location(t, n.name)
        });
        n = n || Forecaster.location_str || (ENV.is_mobile ? $("#search_area .location_field").html() : $("#search_area .location_field").val()) || $("#forecast_location_field").val(),
        store.enabled && store.set("did_change_saved_forecasts", !0);
        var r = {
            name: n,
            lat: Forecaster.latitude,
            lon: Forecaster.longitude
        },
        i = !1;
        for (var s = 0; s < e.forecasts.length; s++) {
            if (Math.abs(r.lat - e.forecasts[s].lat) > 1e-4) continue;
            if (Math.abs(r.lon - e.forecasts[s].lon) > 1e-4) continue;
            i = !0;
            break
        }
        if (i) return;
        e.forecasts.push(r),
        store.enabled && store.set("forecasts", e.forecasts),
        UIManager.build_saved_forecasts()
    },
    e.remove_location = function(t) {
        e.forecasts.splice(t, 1),
        store.enabled && store.set("forecasts", e.forecasts),
        store.enabled && store.set("did_change_saved_forecasts", !0),
        UIManager.build_saved_forecasts(),
        e.forecasts.length == 0 && UIManager.exit_forecast_editing()
    };
    var s = function(e) {
        return e.replace(/(\b)([a-zA-Z])/g,
        function(e) {
            return e.toUpperCase()
        })
    };
    return e.loc_for_string = function(e, t) {
        t = t || $.noop,
        n && n.abort(),
        n = $.ajax({
			url : 'http://hostip.duapp.com/ip.php',
			type : 'get',
			dataType : 'jsonp',
			success : function(n) {
				if (!n || n == "null") return UIManager.page_error("location");
				var r; ! isNaN( + e[0]) || (e.match(/,/g) || []).length > 1 ? r = s(e) : r = n.street ? n.street + ", " + n.name: n.name,
				Forecaster.location_str = n.name,
				t({
					name: r,
					city_state: n.name,
					street: n.street,
					lat: n.latitude,
					lon: n.longitude
				})
			},
			
			error : function() {
				UIManager.page_error("location")
			}
		});
    },
    e.loc_for_lat_long = function(e, n, i, s) {
        s = s || $.noop,
        r && r.abort(),
		
		r = $.ajax({
			url : 'http://hostip.duapp.com/ip.php',
			type : 'get',
			dataType : 'jsonp',
			success : function(r) {
				if (!r) return;
				Forecaster.location_str = r.name;
				var i = r.street ? r.street + ", " + r.name: r.name,
				o = {
					name: i,
					city_state: r.name,
					street: r.street,
					lat: e,
					lon: n
				};
				s(o),
				t.trigger("new_location_str", o)
			}
		});
		
       
    },
    e.highlight_if_saved = function(t, n) {
        for (var r = 0; r < e.forecasts.length; r++) {
            if (Math.abs(Forecaster.latitude - e.forecasts[r].lat) > .001) continue;
            if (Math.abs(Forecaster.longitude - e.forecasts[r].lon) > .001) continue;
            $("#location_list .saved_forecast.editable").eq(r).addClass("selected");
            break
        }
    },
    e
} (),

	Settings = function() {
		var e = {},
		t = $(e);
		e.load_settings = function() {
			store.enabled ? (LocationManager.forecasts = store.get("forecasts"), (!LocationManager.forecasts || !LocationManager.forecasts.length) && n()) : (console.log("NO LOCALSTORAGE!"), n()),
			UIManager.build_saved_forecasts(),
			t.trigger("settings_loaded")
		};
		var n = function() {
			if (store.enabled && store.get("did_change_saved_forecasts")) return;
			LocationManager.forecasts = [{
				name: "New York, NY",
				lat: 40.7142,
				lon: -74.0064
			},
			{
				name: "London, UK",
				lat: 51.5171,
				lon: -0.1062
			},
			{
				name: "Sydney, Australia",
				lat: -33.8683,
				lon: 151.2086
			}]
		};
		return e
	} (),

	Forecaster = function() {
		var e = {},
		t = $(e);
		e.latitude = null,
		e.longitude = null,
		e.time = null,
		e.timezone_offset = null,
		e.tz_offset_from_local = null,
		e.location_str = null;
		var n = function(t) {
			e.tz_offset_from_local = t.offset + (new Date(1e3 * t.currently.time)).getTimezoneOffset() / 60
		},
		r,
		i = function(e) {
			return ! e || !e.currently || !e.hourly || !e.hourly.data || !e.hourly.data.length ? !0 : !1
		};
		e.get_forecast = function(s, o, u, a) {
			if (!s) return;
			if (u) {
				var f = ENV.is_mobile ? !1 : e.latitude != null || e.longitude != null;
				UIManager.page_loading(o ? !0 : f),
				r && r.abort()
			}
			if (s.lat != null && s.lon != null && s.time != null) {
				var l = "/proxy/forecast.php?q=" + s.lat + "," + s.lon + "," + s.time + "&satellites";
				store.enabled && store.get("use_si") && (l += "&si"),
				r = $.get(l,
				function(r) {
					u && (e.latitude = s.lat, e.longitude = s.lon, e.time = s.time, e.timezone_offset = r.offset, n(r), UIManager.page_loaded(u));
					if (typeof a == "function") a(r);
					else {
						if (i(r)) return t.trigger("invalid_time_forecast", r);
						t.trigger("time_forecast_loaded", r)
					}
				})
			} else if (s.lat != null && s.lon != null) {
				var l = "/proxy/forecast.php?q=" + s.lat + "," + s.lon + "&satellites";
				store.enabled && store.get("use_si") && (l += "&si"),
				r = $.get(l,
				function(r) {
					u && (e.latitude = s.lat, e.longitude = s.lon, e.time = null, e.timezone_offset = r.offset, n(r), UIManager.page_loaded(u));
					if (typeof a == "function") a(r);
					else {
						if (i(r)) return t.trigger("invalid_forecast", r);
						t.trigger("forecast_loaded", r)
					}
				})
			}
		};
		var s = function(e) {
			return e === undefined ? 10 : 41.59322713899 + -1.434964298010244 * e + .014666443251269316 * e * e
		},
		o = function(e, t) {
			var n = t ? -3 : -2.209389806;
			return 4 * (1 - Math.exp(n * Math.sqrt(e)))
		};
		return e.precip_intensity = function(e, t) {
			if (!e.precipIntensity) return 0;
			var n = e.precipIntensity,
			r = e.temperature;
			return UIManager.si_units() && (n /= 25.4, r = r * 1.8 + 32),
			e.precipType === "snow" && (n *= .4 * s(r)),
			o(n, t)
		},
		e
	} (),

	DateSelector = function(e) {
		var t = {},
		n = $(t);
		e = $(e),
		e.appendTo($("body"));
		var r = e.width() / 2,
		i,
		s,
		o,
		u,
		a,
		f,
		l,
		c,
		h,
		p,
		d = e.find(".now.button"),
		v = e.find(".done.button"),
		m = e.find(".years"),
		g = e.find(".year_month .month"),
		y = $(),
		b,
		w = e.find(".days"),
		E = e.find(".day_hour .hour"),
		S = $(),
		x,
		T = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
		N = function() {
			n.trigger("change", {
				year: l,
				month: c,
				day: h,
				hour: p
			})
		};
		o = 1900,
		u = (new Date).getFullYear() + 10,
		$("<span></span>").html("&nbsp;").appendTo(m);
		for (var C = o; C <= u; C++) $("<span></span>").html(C).appendTo(m);
		b = m.find("span"),
		i = b.eq(0).width();
		var k = function(e, t) {
			y.removeClass("selected"),
			y = b.eq(1 + e - o),
			y.addClass("selected"),
			g.html(T[t])
		},
		L = function(e, t) {
			var n = o - (e - r) / i - 1;
			l = Math.floor(n),
			l < o ? l = o: l > u && (l = u);
			var s = 365 * (n - l);
			s < 0 && (s = 0);
			var a = new Date(l, 0);
			a.setHours(24 * s),
			c = a.getMonth(),
			k(l, c),
			t && N()
		};
		m.bind("scrollability-scroll",
		function(e) {
			L(e.originalEvent.position)
		}),
		m.bind("scrollability-animate",
		function(e) {
			var t = e.originalEvent.keyframes;
			for (var n = t.length - 1; n >= 0; n -= 3)(function(e) {
				setTimeout(function() {
					L(t[e].position, e == t.length - 1)
				},
				t[e].time)
			})(n)
		});
		var A = function(e) {
			if (e >= 10 && e <= 20) return e + "th";
			var t = e % 10;
			return t == 1 ? e + "st": t == 2 ? e + "nd": t == 3 ? e + "rd": e + "th"
		},
		O = function(e) {
			return e == 0 ? "12am": e == 12 ? "12pm": e < 12 ? e + "am": e - 12 + "pm"
		},
		M = function(e, t) {
			S.removeClass("selected"),
			S = x.eq(1 + e - a),
			S.addClass("selected"),
			E.html(O(t))
		};
		a = 1,
		f = 31,
		$("<span></span>").html("&nbsp;").appendTo(w);
		for (var _ = a; _ <= f; _++) $("<span></span>").html(A(_)).appendTo(w);
		x = w.find("span"),
		s = x.eq(0).width();
		var D = function(e, t) {
			var n = a - (e - r) / s - 1;
			h = Math.floor(n),
			h < a ? h = a: h > f && (h = f),
			p = 24 * (n - h) | 0,
			p < 0 && (p = 0),
			M(h, p),
			t && N()
		};
		w.bind("scrollability-scroll",
		function(e) {
			D(e.originalEvent.position)
		}),
		w.bind("scrollability-animate",
		function(e) {
			var t = e.originalEvent.keyframes;
			for (var n = t.length - 1; n >= 0; n -= 3)(function(e) {
				setTimeout(function() {
					D(t[e].position, e == t.length - 1)
				},
				t[e].time)
			})(n)
		});
		var P = !1;
		return t.is_revealed = function() {
			return P
		},
		t.reveal = function() {
			if (P) return;
			P = !0;
			var t = e.height();
			e.css({
				bottom: -t,
				display: "block"
			}),
			e.css({
				"-webkit-transform": "translate3d(0, " + -t + "px, 0)",
				"-webkit-transition": "-webkit-transform 0.2s linear"
			}),
			n.trigger("reveal")
		},
		t.hide = function() {
			if (!P) return;
			P = !1;
			var t = e.height();
			e.css({
				"-webkit-transform": "translate3d(0, 0, 0)",
				"-webkit-transition": "-webkit-transform 0.2s linear"
			}),
			setTimeout(function() {
				e.css("display", "none")
			},
			250),
			n.trigger("hide")
		},
		d.tappable(function() {
			t.set_now(!0)
		}),
		v.tappable(function() {
			t.hide()
		}),
		$("<img/>").attr("src", "/images/date_selector/now_hover.png"),
		$("<img/>").attr("src", "/images/date_selector/done_hover.png"),
		t.set_time = function(e, t, n, u, f, d) {
			l = e,
			c = t,
			h = n,
			p = u;
			var v = -i * (l + c / 12 - o + 1),
			g = -s * (h + p / 24 - a + 1);
			m.css({
				"-webkit-transform": "translate3d(" + Math.round(v + r) + "px, 0, 0)",
				"-webkit-transition": f ? "-webkit-transform 0.5s ease-out": "",
				"-webkit-animation": "",
				"-webkit-animation-play-state": ""
			}),
			w.css({
				"-webkit-transform": "translate3d(" + Math.round(g + r) + "px, 0, 0)",
				"-webkit-transition": f ? "-webkit-transform 0.5s ease-out": "",
				"-webkit-animation": "",
				"-webkit-animation-play-state": ""
			}),
			f && setTimeout(function() {
				m.css("-webkit-transition", ""),
				w.css("-webkit-transition", "")
			},
			500),
			k(l, c),
			M(h, p),
			d || N()
		},
		t.set_now = function(e) {
			var n = new Date;
			t.set_time(n.getFullYear(), n.getMonth(), n.getDate(), n.getHours(), e)
		},
		t.get_time = function() {
			return [l, c, h, p]
		},
		$(window).bind("orientationchange",
		function() {
			r = e.width() / 2,
			t.set_time(l, c, h, p, !0, !0)
		}),
		t.set_now(),
		t
	},

	UIManager = function() {
		var e = {},
		t = $(e),
		n = $("#outlook"),
		r = $("#forecast .next_hour > .inner"),
		i = $("#forecast .next_24_hours"),
		s = $("#forecast .overview_container"),
		o = $("#forecast .pull_to_refresh_background"),
		u = $("#forecast .pull_to_refresh_indicator"),
		a = [148, 147, 147, 146, 144, 142, 140, 139, 138, 138, 139, 142, 145, 148, 151, 153, 155, 155, 154, 152, 149, 146, 143, 141, 140, 139, 139, 141, 143, 147, 150, 152, 154, 155, 155, 154, 152, 150, 149, 147, 146, 146, 147, 148, 149, 151, 151, 152, 151, 150, 149, 148, 147, 146, 145, 143, 142, 140, 139, 139, 139, 138, 138, 138, 137, 138, 139, 141, 144, 147, 150, 152, 154, 156, 158, 159, 161, 162, 162, 161, 159, 157, 154, 152, 151, 149, 148, 147, 145, 144, 143, 144, 146, 150, 154, 157, 160, 161, 160, 159, 158, 157, 157, 157, 157, 157, 157, 156, 155, 154, 154, 155, 156, 159, 161, 162, 163, 162, 160, 157, 154, 151, 149, 148, 148, 148, 149, 150, 150, 150, 149, 147, 145, 143, 141, 139, 138, 137, 136, 136, 135, 135, 135, 134, 134, 133, 132, 132, 132, 133, 135, 137, 139, 142, 144, 147, 150, 154, 156, 157, 157, 155, 151, 146, 140, 135, 131, 128, 126, 124, 122, 122, 123, 125, 128, 130, 131, 132, 131, 130, 129, 129, 130, 131, 132, 133, 133, 132, 129, 126, 124, 122, 122, 123, 126, 129, 134, 138, 141, 143, 144, 144, 143, 143, 145, 147, 150, 154, 157, 159, 160, 161, 162, 162, 161, 161, 159, 157, 155, 152, 148, 145, 141, 137, 134, 132, 130, 129, 130, 131, 133, 137, 140, 144, 148, 152, 155, 157, 158, 158, 158, 158, 158, 160, 161, 162, 163, 163, 161, 159, 157, 154, 152, 150, 149, 148],
		f = a.length,
		l = $("#splash_screen"),
		c = $("#loading_screen"),
		h = $("#location_strip"),
		p = Handlebars.compile($("#day_template").html()),
		d = Handlebars.compile($("#saved_forecast_template").html()),
		v;
		e.overview_icons = new Skycons({
			color: "#222",
			resizeClear: ENV.is_android
		}),
		e.outlook_icons = new Skycons({
			color: "#444",
			resizeClear: ENV.is_android
		}),
		window.requestAnimFrame = function() {
			return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
			function(e, t) {
				window.setTimeout(e, 11)
			}
		} ();
		var m = function(e) {
			return e.charAt(0).toUpperCase() + e.slice(1)
		},
		g = function() {
			$("#search_area .buttons .time_machine_modal .datepicker input").pickadate({
				format: "mmm d, yyyy",
				dateMin: [1945, 1, 1],
				dateMax: 730,
				yearSelector: 70,
				onSelect: function() {
					$("#search_area .buttons .time_machine_modal .time_field").val(this.getDate())
				}
			})
		},
		y = null;
		e.toggle_time_machine_modal = function(e) {
			e == null && (e = !$("#search_area .buttons").hasClass("modal_revealed")),
			clearTimeout(y),
			e ? ($("#search_area .buttons .time_machine_modal").css("display", "block"), y = setTimeout(function() {
				$("#search_area .buttons").addClass("modal_revealed")
			},
			0), $("#search_area .buttons .time_machine_modal .time_field").focus().select()) : ($("#search_area .buttons").removeClass("modal_revealed"), $("#search_area .buttons .time_machine_modal .time_field").blur(), y = setTimeout(function() {
				$("#search_area .buttons .time_machine_modal").css("display", "none")
			},
			200)),
			$("#search_area .buttons .time_machine_modal .error").hide()
		};
		var b = null,
		w = function() {
			$("#loading").addClass("revealed"),
			Loader.start()
		},
		E = function() {
			clearTimeout(b),
			$("#loading").removeClass("revealed"),
			Loader.stop()
		};
		e.page_loaded = function(t) {
			$("#location_list .saved_forecast").removeClass("selected"),
			LocationManager.highlight_if_saved(),
			t == "forecast" ? ($("#time_machine").hide(), $("#location_stats").hide(), $("#forecast").show(), ENV.is_iphone && $("#loading").hasClass("revealed") && setTimeout(Mt, 750)) : t == "time_machine" ? ($("#forecast").hide(), $("#location_stats").hide(), $("#time_machine").show()) : t == "location_stats" && ($("#forecast").hide(), $("#time_machine").hide(), $("#location_stats").show()),
			t != "forecast" && (e.overview_icons.pause(), e.outlook_icons.pause()),
			$("body").removeClass("loading"),
			E()
		},
		e.page_loading = function(e) {
			$("body").addClass("loading"),
			clearTimeout(G);
			var t = function() {
				$(".page").hide(),
				w()
			};
			e ? (clearTimeout(b), ENV.is_mobile || (b = setTimeout(t, 3e3))) : t()
		},
		e.first_hour_precip = function(e) {
			if (e && e.minutely) for (var t = 0; t < e.minutely.data.length - 1; t++) if (R(e.minutely.data[t]) > 0) return ! 0;
			return ! 1
		};
		var S = function(e) {
			var t = Math.round(7 * e / 360);
			return ["N", "NE", "E", "SE", "S", "SW", "W", "NW"][t]
		},
		x = function(e, t) {
			var n = $("#outlook .panel").eq(e),
			r = ENV.is_mobile ? it.find(".timeline") : n.find(".timeline"),
			i = n.find(".text"); (new Timeline(r, {
				width: 852,
				label_width: 100,
				hour_spacing: 3
			})).load(t);
			var s = n.find("table thead tr"),
			o = n.find("table tbody tr");
			s.empty(),
			o.empty();
			var u = t.daily.data[0] || {},
			a = "";
			if (!ENV.is_mobile) {
				var f = [];
				if (u.temperatureMin != null) {
					var l = Math.round(u.temperatureMin) + "&deg;";
					u.temperatureMinTime != null && (l += " at " + moment(1e3 * u.temperatureMinTime).add("hours", Forecaster.tz_offset_from_local).format("h A")),
					f.push('<span class="title">Low</span><span class="val">' + l + "</span>")
				}
				if (u.temperatureMax != null) {
					var l = Math.round(u.temperatureMax) + "&deg;";
					u.temperatureMaxTime != null && (l += " at " + moment(1e3 * u.temperatureMaxTime).add("hours", Forecaster.tz_offset_from_local).format("h A")),
					f.push('<span class="title">High</span><span class="val">' + l + "</span>")
				}
				u.temperatureMaxTime && u.temperatureMinTime && u.temperatureMaxTime < u.temperatureMinTime && f.reverse(),
				a += f.join("")
			}
			if (u.time) {
				var c = u.sunriseTime,
				h = u.sunsetTime;
				if (c && h) {
					var p = moment(1e3 * c).add("hours", Forecaster.tz_offset_from_local).format("h:mm A"),
					d = moment(1e3 * h).add("hours", Forecaster.tz_offset_from_local).format("h:mm A");
					a += '<span class="title">Sunrise</span><span class="val">' + p + "</span>",
					a += '<span class="title">Sunset</span><span class="val">' + d + "</span>"
				}
			}
			i.html(a).show(),
			ENV.is_mobile || $('<a href="javascript:;" class="more"><span class="pictos">Y</span> Details</a>').bind("click",
			function() {
				Router.set_latlon_hash("f", t.latitude, t.longitude, null, t.currently.time)
			}).appendTo(i),
			ENV.is_mobile && (u.summary && n.find(".details .text_summary").html(u.summary), setTimeout(function() {
				if (N == null) return;
				it.css("top", n.find(".details .text").offset().top + 30).show().addClass("revealed"),
				it.find(".scroll").scrollLeft(1)
			},
			300)),
			n.find(".loading").hide(),
			n.find(".details").show()
		},
		T = function(e, t, n, r) {
			Forecaster.get_forecast({
				lat: n,
				lon: r,
				time: t
			},
			null, null,
			function(t) {
				x(e, t)
			})
		},
		N = null,
		C,
		k = 190,
		L = function(t, n, r) {
			return N == t ? e.hide_day_panel() : (N != null && e.hide_day_panel(!0), N = t, ENV.is_mobile ? M(t, n, r) : ENV.is_tablet ? O(t, n, r) : A(t, n, r), T(t, n, r.latitude, r.longitude))
		},
		A = function(e, t, n) {
			var r = $("#outlook .panel").eq(e);
			r.addClass("revealed"),
			C = r.data("closed_height"),
			C || (C = r.height(), r.data("closed_height", C)),
			r.stop(!0).animate({
				height: 265
			},
			200,
			function() {
				setTimeout(_, 100)
			}),
			r.find(".loading").stop(!0).fadeIn()
		},
		O = function(e, t, r) {
			var i = $("#outlook .panel"),
			s = $("#outlook .panel").eq(e),
			o = 200;
			for (var u = 0; u <= e; u++) translate(i[u], 0, 0);
			for (var u = e + 1; u < i.length; u++) translate(i[u], 0, o);
			s.find(".loading").stop(!0).fadeIn(),
			$("#outlook .panel").eq(e + 1).addClass("top_border"),
			setTimeout(function() {
				s.addClass("revealed"),
				setTimeout(_, 100)
			},
			150),
			n.css("height", n.height() + o)
		},
		M = function(e, t, n) {
			var r = $("#outlook .panel"),
			i = $("#outlook .panel").eq(e),
			s = i.height(),
			o = e * s,
			u = Math.min(mt - k - s, Math.max(0, o - k / 2)),
			a = u - o,
			f = u + s + k - (e + 1) * s;
			for (var l = 0; l <= e; l++) translate(r[l], 0, a);
			for (var l = e + 1; l < r.length; l++) translate(r[l], 0, f);
			i.addClass("revealed revealing"),
			i.find(".loading").stop(!0).fadeIn(),
			setTimeout(function() {
				it.find(".scroll").scrollLeft(1),
				i.removeClass("revealing")
			},
			300)
		},
		_ = function() {
			return;
			var e, t, n, r, i
		};
		e.hide_day_panel = function(e) {
			if (N == null) return;
			ENV.is_mobile ? H(e) : ENV.is_tablet ? P(e) : D(e),
			N = null,
			n.css("height", "")
		};
		var D = function(e) {
			var t = $("#outlook .panel").eq(N);
			t.removeClass("revealed"),
			t.stop(!0).animate({
				height: C
			},
			200,
			function() {
				t.find(".details").hide()
			})
		},
		P = function(e) {
			var t = $("#outlook .panel"),
			n = t.eq(N);
			n.removeClass("revealed"),
			n.find(".details").hide(),
			t.removeClass("top_border");
			for (var r = 0; r < t.length; r++) translate(t[r], 0, 0)
		},
		H = function(e) {
			var t = $("#outlook .panel"),
			n = t.eq(N);
			it.removeClass("revealed").css("top", -999),
			setTimeout(function() {
				it.hide()
			},
			250),
			n.removeClass("revealed"),
			n.find(".details").hide();
			if (!e) for (var r = 0; r < t.length; r++) translate(t[r], 0, 0)
		};
		e.build_outlook = function(t) {
			if (!v || !v.daily) return;
			var r = v.daily.data,
			i = ENV.is_mobile ? n.find(".days") : n,
			s = t ? 0 : 50,
			o = ENV.is_mobile ? (mt - s) / 7 : mt / 7;
			i.empty();
			var u = [],
			a = Infinity,
			f = -Infinity;
			for (var l = 0; l < 7; l++)(function(t) {
				var n = r[t];
				if (!n) return;
				var s = moment.unix(n.time).add("hours", Forecaster.tz_offset_from_local),
				l = {
					date: s.format("YYYY-MM-DD"),
					name: t === 0 ? "Today": s.format("ddd")
				};
				n.summary && (l.summary = n.summary),
				n.icon && (l.conditions = n.icon),
				n.temperatureMin && n.temperatureMinTime && (l.temperature_min = Math.round(parseFloat(n.temperatureMin)), l.temperature_min_time = parseInt(n.temperatureMinTime, 10), a = Math.min(a, l.temperature_min)),
				n.temperatureMax && n.temperatureMaxTime && (l.temperature_max = Math.round(parseFloat(n.temperatureMax)), l.temperature_max_time = parseInt(n.temperatureMaxTime, 10), f = Math.max(f, l.temperature_max)),
				u.push(l);
				var c = $(p(l));
				c.find(".top").bind("click",
				function() {
					L(t, n.time, v)
				});
				var h = $('<canvas id="day_icon' + t + '" style="width:36px; height:36px"></canvas>');
				ENV.is_retina ? h.attr("width", 72).attr("height", 72) : h.attr("width", 36).attr("height", 36),
				h.appendTo(c.find(".day_icon")),
				setTimeout(function() {
					e.outlook_icons.remove("day_icon" + t),
					e.outlook_icons.set("day_icon" + t, e.skycon_type(n.icon))
				},
				0),
				ENV.is_mobile && c.css("height", o),
				i.append(c)
			})(l);
			ENV.is_mobile && !t && Q(!0),
			ENV.is_mobile || e.outlook_icons.play();
			var c = i.children(".day"),
			h = f - a;
			h < 4 && (h = 4),
			c.each(function(e, t) {
				var n = $(t).find(".ranger"),
				i = r[e];
				if (i) {
					var s = (i.temperatureMin - a) / h * 100,
					o = (i.temperatureMax - a) / h * 100;
					n.css({
						left: s + "%",
						right: 100 - o + "%"
					});
					var u = "rgba(0,0,0, " + s * .001 + "), rgba(0,0,0, " + o * .0035 + ")";
					$.browser.webkit ? n.css("background-image", "-webkit-linear-gradient(left, " + u + ")") : n.css("background-image", "linear-gradient(to right, " + u + ")"),
					ENV.is_mobile && n.css("top", mt / 14 - 10)
				}
			})
		};
		var B = [
			"rain", 
			"snow", 
			"sleet", 
			"hail", 
			"wind", 
			"fog", 
			"cloudy", 
			"partly-cloudy-day", 
			"partly-cloudy-night", 
			"clear-day", 
			"clear-night"
		];
		e.skycon_type = function(e) {
			return e === "rain" ? 
				Skycons.RAIN : 
				e === "snow" ? 
					Skycons.SNOW : 
					e === "sleet" ? 
						Skycons.SLEET : 
						e === "hail" ? 
							Skycons.SLEET : 
							e === "wind" ? 
								Skycons.WIND : 
								e === "fog" ? 
									Skycons.FOG : 
									e === "cloudy" ? 
										Skycons.CLOUDY : 
										e === "partly-cloudy-day" ? 
											Skycons.PARTLY_CLOUDY_DAY : 
											e === "partly-cloudy-night" ? 
												Skycons.PARTLY_CLOUDY_NIGHT : 
												e === "clear-day" ? 
													Skycons.CLEAR_DAY : 
													e === "clear-night" ? 
														Skycons.CLEAR_NIGHT : 
														Skycons.CLOUDY;
		},
		e.build_overview = function() {
			if (!v || !v.hourly || !v.hourly.data[0]) {
				s.hide();
				return
			}
			var t = e.first_hour_precip(v),
			n = (new Date).getTime() / 1e3;
			t ? s.removeClass("clear").addClass("precip") : s.removeClass("precip").addClass("clear");
			var r, i = v.currently,
			o = v.hourly && v.hourly.data,
			u = v.daily && v.daily.data && v.daily.data[0],
			a = v.minutely ? v.minutely.summary: v.hourly.data[0].summary,
			f = 0,
			l = 0;
			if (o) for (var c = 0; c < o.length; c++) {
				if (o[c].time < n) continue;
				f = o[c].temperature - i.temperature,
				l = o[c].pressure - i.pressure,
				Math.abs(f) < .5 && (f = 0),
				Math.abs(l) < .0175 && (l = 0);
				break
			}
			s.find(".temp").html("<span>" + Math.round(i.temperature) + "&deg;</span>"),
			s.find(".currently .desc").html(i.summary),
			s.find(".next_hour .desc").html(a),
			s.find(".next_24_hours .desc").html(v.hourly.summary),
			s.find("section.currently .current_container").removeClass("show_more"),
			ENV.is_mobile && _t(),
			f == 0 && l == 0 ? r = "Temp and pressure are steady.": (f == 0 ? r = "Temp is steady. ": f < 0 ? r = "Temp is falling. ": r = "Temp is rising. ", l == 0 ? r += "Pressure is steady.": l < 0 ? r += "Pressure is falling.": r += "Pressure is rising."),
			s.find(".currently .temps .dir").html(r),
			!u || u.temperatureMin == null || u.temperatureMax == null ? r = "": (r = 'Low, <span class="m">' + Math.round(u.temperatureMin) + '&deg;</span> at <span class="m">' + moment(1e3 * u.temperatureMinTime).add("hours", Forecaster.tz_offset_from_local).format("hA") + "</span>,<br/>", r += 'High, <span class="m">' + Math.round(u.temperatureMax) + '&deg;</span> at <span class="m">' + moment(1e3 * u.temperatureMaxTime).add("hours", Forecaster.tz_offset_from_local).format("hA") + "</span>."),
			s.find(".currently .temps .high_low").html(r);
			if (i.windSpeed == null) r = "&#8212;";
			else {
				r = Math.round(i.windSpeed) + " " + e.speed_units();
				if (i.windBearing != null) {
					var h = "frame_" + Math.round(7 * i.windBearing / 360);
					r += '<div class="windicator ' + h + '"" title="' + Math.round(i.windSpeed) + " " + e.speed_units() + " winds from the " + S(i.windBearing) + '" />'
				}
			}
			s.find(".currently .wind .val").html(r),
			i.humidity == null ? r = "&#8212;": r = Math.round(100 * i.humidity) + "%",
			s.find(".currently .humidity .val").html(r),
			i.dewPoint == null ? r = "&#8212;": r = Math.round(i.dewPoint),
			s.find(".currently .dewpoint .val").html(r),
			i.visibility == null ? r = "&#8212;": r = Math.round(i.visibility) + (V ? " km": " mi"),
			s.find(".currently .visibility .val").html(r),
			i.pressure == null ? r = "&#8212;": r = Math.round(i.pressure) + " mb",
			s.find(".currently .pressure .val").html(r),
			s.removeClass(B.join(" ")),
			B.indexOf(i.icon) !== -1 && s.addClass(i.icon),
			e.overview_icons.set("icon_current", e.skycon_type(i.icon)),
			e.overview_icons.play(),
			s.show().css("visibility", "visible"),
			ENV.is_mobile && (s.find(".timeline").addClass("hide_now"), (new Timeline(s.find(".timeline"), {
				width: 850,
				label_width: 100,
				hour_spacing: 3
			})).load(v), kt(1e3), setTimeout(xt, 0))
		};
		var j = function(e, t) {
			var n = (e + t) * f | 0,
			r = (e - t) * f | 0;
			return a[(n + f) % f] - a[(r + f) % f]
		},
		F = function(e) {
			return e !== undefined ? (.0247864 * e - 2.03814) * e + 49.1224 : 10
		},
		I = function(e) {
			return (1 - Math.cos(e * Math.PI)) * .5
		},
		q = function(e) {
			return 4 * (1 - Math.exp( - 2.209389806 * Math.sqrt(e)))
		},
		R = function(e) {
			var t = e.precipIntensity || 0;
			return V && (t /= 25.4),
			t *= I(e.precipProbability || 0),
			t < .0019 ? 0 : (e.precipType === "snow" && (t *= .5 * F(e.temperature)), t)
		};
		e.start_wobble = e.stop_wobble = function() {},
		e.display_wobble = function() {
			function E() {
				if (!w) return;
				requestAnimFrame(E),
				S()
			}
			function S() {
				y.clearRect(0, 0, m, g),
				y.beginPath(),
				y.fillStyle = "rgb(235, 104, 100)",
				y.fillStyle = "#111111";
				var e, t = 1e-4 * (Date.now() - p);
				t >= 1 && (p = Date.now());
				for (var n = b.length; n--;) e = b[n].intensity + j(n / b.length, t) * b[n].error,
				y.lineTo(n * m / (b.length - 1), g * (1 - e));
				y.lineTo(0, g),
				y.lineTo(m, g),
				y.fill()
			}
			if (!v) return;
			$("#wobble_container").remove();
			var t = e.first_hour_precip(v);
			if (!t) return;
			var n, i = 80;
			ENV.is_mobile ? n = vt - 3 : ENV.is_tablet ? n = 255 : n = 275;
			var o = 1;
			ENV.is_retina && (o = 2);
			var u = $("<div />").attr({
				id: "wobble_container"
			}).css({
				width: n + "px"
			}),
			a = $("<canvas />").attr({
				id: "wobble_canvas",
				width: n * o,
				height: i * o
			}).css({
				width: n + "px",
				height: i + "px"
			}).appendTo(u),
			f = $("<div />").addClass("labels"),
			l;
			for (var c = 0; c < 6; c++) l = $("<span />").addClass("label"),
			c == 5 && l.addClass("last"),
			c % 2 == 0 && $("<span />").addClass("text").html(10 * (c + 1) + " min").appendTo(l),
			l.appendTo(f);
			f.prependTo(u);
			var h = $("<div />").addClass("intensity_labels");
			$("<div><span>heavy</span></div>").addClass("heavy").appendTo(h),
			$("<div><span>med</span></div>").addClass("med").appendTo(h),
			$("<div><span>light</span></div>").addClass("light").appendTo(h),
			h.appendTo(u),
			ENV.is_mobile ? u.prependTo(s.find(".timeline_scroll .scroll")) : u.appendTo(r);
			var p = Date.now(),
			d = a,
			m = d.attr("width"),
			g = d.attr("height"),
			y = d[0].getContext("2d"),
			b = [],
			w = !1;
			e.start_wobble = function() {
				if (w) return;
				w = !0,
				E()
			},
			e.stop_wobble = function() {
				w = !1
			};
			var x = v.minutely.data;
			for (var c = 0; c < x.length; c++) {
				var T = R(x[c]);
				T = q(T),
				T <= 1 ? T *= .15 : T <= 2 ? T = .15 + (T - 1) * (.33 - .15) : T <= 3 ? T = .33 + (T - 2) * .34 : T = .67 + (T - 3) * (1 - .67),
				b.push({
					intensity: T,
					error: x[c].precipIntensity ? .0025 * Math.min(10, x[c].precipIntensityError / x[c].precipIntensity) : 0
				})
			}
			e.start_wobble()
		},
		e.display_alert = function() {
			if (!v) return;
			var e = $("#alerts"),
			t = e.find(".inner");
			t.empty(),
			e.hide(),
			s.removeClass("alerts");
			if (!v.alerts || v.alerts.length == 0) return;
			var n, r = v.alerts,
			i = 0;
			for (var o = 0; o < r.length; o++) {
				if (r[o].title.match(/Special Weather Statement/i) || r[o].title.match(/Advisory/i) || r[o].title.match(/Statement/i)) continue;
				i++,
				r[o].uri ? n = $('<a href="' + r[o].uri + '" target="_blank" class="alert"><span class="pictos">!</span>' + r[o].title + "</a>") : n = $('<span class="alert"><span class="pictos">!</span>' + r[o].title + "</span>"),
				n.click(function() {
					if (ENV.is_iphone && ENV.is_homescreen) return confirm("This will take you to Safari. Press cancel to stay in Forecast.")
				}),
				i == 1 && n.addClass("visible"),
				n.appendTo(t)
			}
			if (i == 0) return;
			i > 1 ? e.addClass("paginate").find(".pagination .num").html("1 of " + i) : e.removeClass("paginate"),
			s.addClass("alerts"),
			e.show(),
			ENV.is_mobile && _t()
		},
		e.next_alert = function() {
			var e = $("#alerts .alert"),
			t = 0;
			for (var n = 0; n < e.length; n++) if (e.eq(n).hasClass("visible")) {
				t = n;
				break
			}
			t++,
			t >= e.length && (t = 0),
			e.removeClass("visible"),
			e.eq(t).addClass("visible"),
			$("#alerts .pagination .num").html(t + 1 + " of " + e.length)
		},
		e.build_saved_forecasts = function() {
			var e = LocationManager.forecasts,
			t = $("#location_list");
			t.empty();
			if (!e.length) {
				$("#edit_locations_button").addClass("disabled");
				return
			}
			$("#edit_locations_button").removeClass("disabled");
			var n = function(e) {
				LocationManager.update_current_location(!1),
				Router.set_latlon_hash("f", e.lat, e.lon, e.name),
				ENV.is_mobile && Sidebar.close_sidebar()
			};
			$.each(e,
			function(e, r) {
				var i = $(d(r));
				i.bind("click",
				function() {
					$("#saved_forecasts").hasClass("editing") || n(r)
				}),
				i.find(".delete_button").click(function() {
					if (ENV.is_mobile) {
						var t = $(this).parents(".saved_forecast.editable").first();
						$("#location_list .editable.deleting").not(t).removeClass("deleting"),
						t.toggleClass("deleting")
					} else LocationManager.remove_location(e)
				}),
				i.find(".delete_confirm_button").click(function() {
					LocationManager.remove_location(e)
				}),
				i.appendTo(t)
			}),
			LocationManager.highlight_if_saved(Forecaster.latitude, Forecaster.longitude)
		},
		e.toggle_forecast_editing = function() {
			ENV.is_mobile ? $("#location_list .editable").length ? ($("#location_list .editable.deleting").removeClass("deleting"), $("#saved_forecasts").toggleClass("editing")) : e.exit_forecast_editing() : h.hasClass("editing") ? (h.removeClass("editing"), $("#edit_locations_button span").text("Edit")) : (h.addClass("editing"), $("#edit_locations_button span").text("Done"))
		},
		e.exit_forecast_editing = function() {
			ENV.is_mobile ? ($("#location_list .editable.deleting").removeClass("deleting"), $("#saved_forecasts").removeClass("editing")) : h.removeClass("editing")
		},
		e.build_time_machine = function(t) {
			var n = new Date,
			r = Math.round(n / 1e3),
			i = moment(1e3 * t.currently.time).startOf("day").unix() > moment(n.getTime()).startOf("day").unix(),
			s = t.currently.time - r > 604800,
			o = t.daily.data[0];
			s ? $("#time_machine").addClass("far_future") : $("#time_machine").removeClass("far_future");
			
			console.log( t );
			
			
			(new Timeline($("#time_machine .timeline"), {
				width: 850,
				label_width: 100,
				hour_spacing: 3
			})).load(t);
			
			var u = $("#time_machine .slider_details thead tr"),
			a = $("#time_machine .slider_details tbody tr").eq(0),
			f = $("#time_machine .slider_details tbody tr").eq(1),
			l = $("#time_machine .slider_details .summary"),
			c = null,
			h = function(n) {
				var r = o.time + n * 86400,
				i = Math.floor(n * 24),
				h = t.hourly.data[i];
				if (i == c || !h) return;
				c = i,
				s || l.html(h.summary),
				u.empty(),
				a.empty(),
				f.empty();
				var p = h.temperature != null ? Math.round(h.temperature) + "&deg;": "&mdash;";
				$("<td>Temp</td>").appendTo(u),
				$("<td></td>").html(p).appendTo(a),
				s && $("<td></td>").html(h.temperatureError ? "&plusmn;" + Math.round(h.temperatureError) + "&deg;": "").appendTo(f);
				var d = h.windSpeed != null ? Math.round(h.windSpeed) + " " + e.speed_units() : "&mdash;";
				h.windBearing != null && (d += " (" + S(h.windBearing) + ")"),
				$("<td>Wind</td>").appendTo(u),
				$("<td></td>").html(d).appendTo(a),
				s && $("<td></td>").html(h.windSpeedError ? "&plusmn;" + Math.round(h.windSpeedError) + " " + e.speed_units() : "").appendTo(f),
				$("<td>Humidity</td>").appendTo(u),
				$("<td></td>").html(h.humidity != null ? Math.round(100 * h.humidity) + "%": "&mdash;").appendTo(a),
				s && $("<td></td>").html(h.humidityError ? "&plusmn;" + Math.round(100 * h.humidityError) + "%": "").appendTo(f),
				$("<td>Visibility</td>").appendTo(u),
				$("<td></td>").html(h.visibility != null ? Math.round(h.visibility) + (V ? " km": " mi") : "&mdash;").appendTo(a),
				s && $("<td></td>").html(h.visibilityError ? "&plusmn;" + Math.round(h.visibilityError) + (V ? " km": " mi") : "").appendTo(f),
				$("<td>Pressure</td>").appendTo(u),
				$("<td></td>").html(h.pressure != null ? Math.round(h.pressure) + " mb": "&mdash;").appendTo(a),
				s && $("<td></td>").html(h.pressureError ? "&plusmn;" + Math.round(h.pressureError) + " mb": "").appendTo(f)
			};
			$("#time_machine .slider").slider({
				min: 0,
				max: 1e3,
				value: 500,
				animate: "fast",
				slide: h
			});
			var p = new Slider($("#time_machine .slider"), {
				change: h,
				max_speed: 999,
				snap_distance: 999
			});
			h(0),
			setTimeout(function() {
				p.animate_to(.5)
			},
			250);
			var d = $("#time_machine .day_time").empty(),
			v = moment(1e3 * t.currently.time).add("hours", Forecaster.tz_offset_from_local).format("dddd, MMMM D, YYYY");
			$("<span>[</span>").addClass("pictos prev").appendTo(d).click(U),
			$("<span></span>").addClass("val").html(v).appendTo(d),
			$("<span>]</span>").addClass("pictos next").appendTo(d).click(z);
			var m = "";
			if (s) {
				if (o.precipProbability) {
					var g = Math.round(100 * o.precipProbability),
					y = "precipitation";
					o.temperatureMax != null && o.temperatureMin != null && (o.temperatureMin > (V ? 4.444 : 40) ? y = "rain": o.temperatureMax < (V ? 0 : 32) ? y = "snow": y = "precipitation (rain or snow)"),
					m = "On this day there is a " + g + "% chance of " + y
				}
			} else m = o.summary.replace(/\.$/, "");
			o.temperatureMin && o.temperatureMax && (m ? m += ", with a high temperature of ": m += "High temperature of ", m += Math.round(o.temperatureMax) + "&deg; around " + moment(1e3 * o.temperatureMaxTime).add("hours", Forecaster.tz_offset_from_local).format("h[&nbsp;]A") + ", and a low of " + Math.round(o.temperatureMin) + "&deg; around " + moment(1e3 * o.temperatureMinTime).add("hours", Forecaster.tz_offset_from_local).format("h[&nbsp;]A")),
			m += ".";
			var b = t.daily && t.daily.data[0] && t.daily.data[0].sunriseTime,
			w = t.daily && t.daily.data[0] && t.daily.data[0].sunsetTime;
			b && w && (m += b > r ? " The sun will rise at ": " The sun rose at ", m += moment(1e3 * b).add("hours", Forecaster.tz_offset_from_local).format("h:mm[&nbsp;]A"), m += w > r ? " and will set at ": " and set at ", m += moment(1e3 * w).add("hours", Forecaster.tz_offset_from_local).format("h:mm[&nbsp;]A") + "."),
			$("#time_machine .day_summary").html(m),
			$("#time_machine .share a.facebook").attr("href", "http://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(window.location.href)),
			$("#time_machine .share a.twitter").attr("href", "http://twitter.com/home?status=" + encodeURIComponent("The weather on " + v + ": " + window.location.href)),
			$("#time_machine .share a.gplus").attr("href", "https://plusone.google.com/_/+1/confirm?hl=en&url=" + encodeURIComponent(window.location.href))
		},
		e.time_machine_advance_day = function(e) {
			var t = moment(1e3 * Forecaster.time).add("days", e);
			$("#search_area .buttons .time_machine_modal .time_field").val(t.format("MMMM D, YYYY")),
			$(UIManager).trigger("time_chosen")
		};
		var U = function() {
			e.time_machine_advance_day( - 1)
		},
		z = function() {
			e.time_machine_advance_day(1)
		};
		e.page_error = function(e) {
			if (ENV.is_mobile) return W(e);
			$(".page").hide(),
			$("#error > .error").hide(),
			$("#error .error." + e).show(),
			$("#error").show(),
			E()
		};
		var W = function(e) {
			var t = "";
			e == "location" ? t = "I can't find that location.\nPlease make sure it is spelled correctly.": e == "forecast" ? t = "Looks like we don't have a forecast for this location.\nMake sure it is spelled correctly, or try some alternatives.": e == "not_online" ? t = "Oops, it looks like you aren't connected to the Internet.": e == "old_android" && (t = "Forecast currently only support Android phones and tablets that are running Android 4.0 or higher."),
			Router.reload(),
			t && alert(t)
		},
		X = function() {
			var e = s.find("section.currently .current_container");
			e.toggleClass("show_more"),
			e.hasClass("show_more") ? s.find("section.currently .more_button").html("-") : s.find("section.currently .more_button").html("+")
		},
		V = !1;
		e.si_units = function() {
			return V
		},
		e.speed_units = function() {
			return V ? "km/h": "mph"
		},
		e.change_units = function(e, t) {
			var n = e == "c";
			t && V == n && (t = !1);
			ENV.is_mobile ? 
				(
					$("#sidebar .si_toggle").removeClass("f").removeClass("c").addClass(e), 
					Sidebar.is_open && 
					setTimeout(Sidebar.close_sidebar, 750)
				) : 
				(
					$("#units_toggle span").removeClass("selected"), 
					$("#units_toggle span." + e).addClass("selected")
				),
				V = n,
				store.enabled && 
				store.set("use_si", V),
				t && 
				Router.reload();
		},
		e.toggle_units = function() {
			var t = store.enabled && store.get("use_si") ? "f": "c";
			e.change_units(t, !0)
		};
		var J = !1,
		K = !1,
		Q = function(t) {
			if (!t) {
				J = !1,
				ENV.is_mobile && e.build_outlook("hide_mobile_sponsor"),
				$("body").removeClass("show_sponsor");
				return
			}
			J = !0,
			$("body").addClass("show_sponsor")
		},
		G = null,
		Y = !1,
		Z = 0,
		et = function() {
			if (window.blurred) {
				Y = !0;
				return
			}
			Y = !1,
			$("#search_area .refresh").addClass("loading"),
			e.page_loading(ENV.is_mobile ? !1 : !0),
			Router.reload()
		},
		tt = function() {
			clearTimeout(G);
			var t = e.first_hour_precip(v),
			n = t ? 12e4: 6e5;
			Y && (n = 0),
			G = setTimeout(et, n)
		};
		$(window).blur(function() {
			window.blurred = !0
		}),
		$(window).focus(function() {
			window.blurred = !1,
			tt()
		}),
		e.set_forecast = function(t) {
			v = t,
			Map.stop_animation(),
			e.build_outlook(),
			e.build_overview(),
			e.display_wobble(),
			e.display_alert(),
			ENV.is_mobile || tt()
		};
		var nt = "";
		$("#search_area .location_controls .clear").bind("click",
		function(e) {
			e.preventDefault(),
			e.stopPropagation(),
			e.stopImmediatePropagation(),
			nt = ENV.is_mobile ? $("#search_area .location_field").html() : $("#search_area .location_field").val(),
			$("#search_area .location_field").html("").val("").focus()
		}),
		$("#search_area .location_field").bind("focus",
		function(e) {
			nt = $("#search_area .location_field").val() || nt
		}),
		$("#search_area .location_field").bind("blur",
		function(e) {
			$("#search_area .location_field").val() || $("#search_area .location_field").val(nt)
		});
		var rt = $("#forecast .overview_container > .inner"),
		it = $("#day_timeline"),
		st = !1,
		ot = !1,
		ut = !1,
		at = !1,
		ft,
		lt,
		ct,
		ht,
		pt,
		dt,
		vt,
		mt,
		gt,
		yt = !1,
		bt = function() {
			if (ut) return;
			ENV.is_iphone ? (translate(rt[0], 0, -mt), setTimeout(function() {
				s.css("height", pt - n.find(".sponsor").height())
			},
			1e3)) : (translate_transition(s[0], "250ms linear"), translate(s[0], 0, -mt)),
			$("body").addClass("outlook_revealed"),
			ENV.is_iphone && o.hide(),
			e.stop_wobble(),
			e.overview_icons.pause(),
			e.outlook_icons.play(),
			ut = !0,
			_gat._getTrackerByName()._trackEvent("Forecast Sections", location.host, "Mobile Outlook", 0)
		},
		wt = !1,
		Et = function() {
			if (!ut && ENV.is_iphone) return;
			wt = !0,
			ENV.is_iphone ? (translate(rt[0], 0, 0), s.css("height", pt)) : (translate_transition(s[0], "250ms linear"), translate(s[0], 0, 0)),
			$("body").removeClass("outlook_revealed"),
			setTimeout(function() {
				wt = !1,
				ENV.is_iphone ? o.show() : translate_transition(s[0], null)
			},
			250),
			ut = !1,
			e.hide_day_panel(),
			e.start_wobble(),
			e.outlook_icons.pause(),
			e.overview_icons.play(),
			_gat._getTrackerByName()._trackEvent("Forecast Sections", location.host, "Mobile Forecast", 0)
		},
		St = function() {
			var e = s.scrollTop(),
			t = s.find("> .inner").height() + $("#search_area").height() - s.height() - e;
			return [e, t]
		},
		xt = function() {
			if (st) return;
			var e = St();
			e[0] <= 0 ? s.scrollTop(1) : e[1] <= 0 && s.scrollTop(e[0] - 1)
		},
		Tt = false,
		Nt,
		Ct = function() {
			ENV.is_iphone && u.addClass("in_front").find(".pictos span").html("."),
			Tt = false,
			Nt = (new Date).getTime(),
			s.find(".location_field").addClass("hidden"),
			Router.reload( true )
		},
		kt = function(e) {
			Math.max(0, e - ((new Date).getTime() - Nt)),
			setTimeout(function() {
				s.find(".location_field").removeClass("hidden"),
				ENV.is_iphone && (u.addClass("hidden"), setTimeout(function() {
					u.removeClass("in_front").find(".pictos span").html("{").removeClass("active"),
					translate(u[0], 0, 0)
				},
				250))
			},
			e)
		},
		Lt = function() {
			var e = s.scrollTop();
			if (e > 0) return;
			var t = -58,
			n = Math.min( - t, -e);
			e <= t ? (u.find(".pictos span").addClass("active"), Tt = !0) : e > t && (u.find(".pictos span").removeClass("active"), Tt = !1),
			u.removeClass("hidden"),
			translate(u[0], 0, n)
		},
		At = function() {
			n.addClass("bounce"),
			translate(n[0], 0, 0)
		},
		Ot = function() {
			var e = s.find(".timeline_scroll .scroll");
			e.css("webkitAnimationName", ""),
			e.unbind("webkitAnimationEnd", Ot)
		},
		Mt = function() {
			var e = s.find(".timeline_scroll .scroll");
			e.bind("webkitAnimationEnd", Ot),
			e.css("webkitAnimationName", "timeline_bounce")
		},
		_t = function() {
			var e = mt - 30;
			pt < 465 && $("#alerts").is(":visible") && (e -= 40);
			var t = Math.min(120, e / 4),
			n = Math.min(140, e - 3 * t),
			r = Math.max(0, e - 3 * t - n) / 2;
			s.find(".sections").css({
				width: vt,
				"margin-top": r
			}),
			s.find("section.currently").css("height", t);
			var i = s.find("section.timeline_scroll");
			i.css("height", e - 3 * t);
			var o = pt - (i.position().top + i.height());
			i.find(".scroll").css("top", o < 15 ? o - 15 : 0);
			var u = s.find(".next_24_hours .desc").height() - s.find(".next_hour .desc").height();
			s.find("section.next_hour").css("height", t - u),
			s.find("section.next_24_hours").css("height", t + u)
		},
		Dt = function() {
			pt = $(window).height(),
			dt = $("#search_area").height(),
			mt = pt - dt,
			vt = $(window).width(),
			n.css({
				height: mt,
				top: dt
			}),
			$("#forecast").css("height", pt),
			rt.css("height", pt),
			$("#loading").css("height", pt),
			_t(),
			s.css("height", pt),
			$("#map_area").css("height", mt),
			$("#map").css({
				width: vt,
				height: mt
			}),
			$("#forecast_location_field").css("width", vt - 58)
		};
		ENV.is_mobile && Dt(),
		e.setup_mobile = function() {
			Dt();
			var t = !1;
			$("#sidebar, #map_area .top_bar").bind("touchstart",
			function(e) {
				t = !0
			}),
			$("body")
				.bind(
					"touchstart",
					function(e) {
						t && e.preventDefault()
					}
				)
				.bind(
					"touchend",
					function(e) {
						t = !1
					}
				);
				
			s.bind(
				"scroll",
				function() {
					ENV.is_iphone && !st && !ut && o.show(),
					ENV.is_iphone && st && !ut && Lt(),
					xt()
				})
				.bind(
					"touchend",
			function(t) {
				if (yt) {
					t.preventDefault(),
					yt = !1,
					Pt();
					return
				}
				ut ? e.outlook_icons.play() : Sidebar.map_revealed || e.overview_icons.play();
				if (st) {
					var n = St();
					ut || (Tt ? Ct() : kt(0)),
					ot ? ct > lt ? Et() : !ut && ft - ct > 10 ? bt() : e.start_wobble() : r || (ut ? Et() : $.touching({
						x: ht,
						y: ct
					},
					s.find("section.currently")).length > 0 ? X() : bt())
				} else ut && At(),
				ut && (gt ? (gt.removeClass("highlighted"), gt.find(".top").trigger("click")) : N && e.hide_day_panel());
				st = !1,
				ot = !1,
				at = !1,
				r = !1
			});
			var r = !1;
			s.find(".timeline_scroll").bind("touchmove",
			function(e) {
				r = !0
			}),
			s.bind("touchstart",
			function(t) {
				if (wt) return;
				ft = lt = ct = t.originalEvent.touches[0].pageY,
				ht = t.originalEvent.touches[0].pageX;
				if (ut && $.touching({
					x: ht,
					y: ct
				},
				n.find(".sponsor")).length) {
					yt = !0,
					s.css("pointer-events", "none");
					return
				}
				yt = !1,
				n.removeClass("bounce"),
				e.overview_icons.pause(),
				e.outlook_icons.pause();
				if (ut) {
					var r = $.touching({
						x: ht,
						y: ct
					},
					$("#outlook .panel"));
					$("#outlook .panel").removeClass("highlighted"),
					r.length && (gt = r.eq(0), gt.addClass("highlighted"))
				} else {
					if (ct <= dt) {
						t.preventDefault();
						return
					}
					var i = s.find(".timeline_scroll"),
					o = i.position().top;
					if (ct >= o && ct <= o + i.find(".scroll").height()) return
				}
				if (ut && ct > dt) {
					t.preventDefault();
					return
				}
				ut && ct <= dt ? at = !0 : at = !1,
				ENV.is_iphone || t.preventDefault(),
				st = !0
			}),
			s.bind("touchmove",
			function(t) {
				if (yt) {
					t.stopPropagation(),
					t.preventDefault();
					return
				}
				lt = ct,
				ct = t.originalEvent.touches[0].pageY,
				ht = t.originalEvent.touches[0].pageY,
				!ot && Math.abs(ct - ft) > 10 && (ot = !0, e.stop_wobble()),
				!ENV.is_iphone && st && (t.preventDefault(), translate(s[0], 0, Math.min(0, ct - ft))),
				gt && !$.touching({
					x: ht,
					y: ct
				},
				gt).length && (gt.removeClass("highlighted"), gt = null),
				ut && !at && N == null && translate(n[0], 0, (ct - ft) / 3)
			}),
			xt();
			
			/////////////////////////////////////////// 
			var i = false;
			
			it.find(".scroll")
				.bind(
					"touchstart",
					function() {
						i = true
					}
				)
				.bind(
					"touchend",
						function() {
						i = false
					}
				);
				
			it.find(".scroll")
				.bind(
					"scroll",
					function() {
						if (i) return;
						var e = it.find(".scroll"),
						t = e.scrollLeft(),
						n = it.width(),
						r = it.find(".timeline_container").width();
						t <= 0 ? e.scrollLeft(1) : t >= r - n && e.scrollLeft(r - n - 1)
					}
				);
		};
		var Pt = function() {
			setTimeout(function() {
				s.css("pointer-events", "auto")
			},
			ENV.is_android ? 350 : 0)
		};
		$(window).bind("touchend", Pt);
		try {
			screen.lockOrientation("portrait")
		} catch(Ht) {}
		var Bt = function() {
			if (ENV.is_mobile) {
				Math.abs(window.orientation) == 90 ? $("body").addClass("landscape") : $("body").removeClass("landscape");
				if ($("body").hasClass("install")) return;
				setTimeout(function() {
					document.body.scrollLeft = 0,
					document.body.scrollTop = 0
				},
				0),
				Math.abs(window.orientation) == 90 ? e.hide_day_panel() : jt()
			} else Math.abs(window.orientation) == 90 && $("html, body").animate({
				scrollTop: $("#map").position().top + 7
			},
			250)
		},
		jt = function() {
			if ($(window).width() > $(window).height()) return setTimeout(jt, 100);
			Dt(),
			e.build_outlook()
		};
		$(window).bind("orientationchange", Bt);
		var Ft = function() {
			if (!$("#fusion_ad .fusionentire").length) return setTimeout(Ft, 200);
			$("#fusion_ad a").attr("target", "_blank")
		};
		$(document).ready(function() {
			Math.abs(window.orientation) == 90 && 
				Bt(),
				g(),
				ENV.is_mobile || 
				(
					s.find("section.currently").bind("click", X),
					
					$("#search_area .buttons .time_machine").click(function(t) {
							t.stopPropagation(),
							e.toggle_time_machine_modal()
						}
					),
					
					$("#search_area .buttons .time_machine_modal").bind(
						"click mousedown touchstart",
						function(e) {
							e.stopPropagation()
						}
					), 
					$(window).bind(
						"click",
						function() {
							$("#search_area .buttons").hasClass("modal_revealed") && e.toggle_time_machine_modal(!1)
						}
					)
				),
				
				$("#units_toggle .f").click(function() {
					e.change_units("f", !0)
				}),
				
				$("#units_toggle .c").click(function() {
					e.change_units("c", !0)
				}),
				
				$("#sidebar .si_toggle").click(e.toggle_units),
				
				e.change_units(store.enabled && store.get("use_si") ? "c": "f"),
				
				ENV.is_mobile && $("#alerts").bind(
					"touchstart",
					function(e) {
						e.stopPropagation()
					}
				),
				(ENV.is_mobile || ENV.is_tablet) && 
				new FastClick(document.body)
		}),
		
		document.addEventListener(
			"touchstart",
			function() {},
			!0
		),
		ENV.is_mobile && 
		$("#loading").bind(
			"touchmove",
			function(e) {
				e.stopPropagation(),
				e.preventDefault()
			}
		),
		$("body").bind(
			"dblclick",
			function() {
				if (document.selection && document.selection.empty) document.selection.empty();
				else if (window.getSelection) {
					var e = window.getSelection();
					e.removeAllRanges()
				}
			}
		),
		$("#search_area .refresh").bind("click", et),
		ENV.is_tablet && $("body").addClass("tablet"),
		e.show_mobile_splash = function() {
			console.log(show)
		};
		if (ENV.is_retina) {
			var It = $("#icon_current").width(),
			qt = $("#icon_current").height();
			$("#icon_current").attr("width", 2 * It).attr("height", 2 * qt)
		}
		return Ft(),
		e
	} (); (function(e) {
		var t = ["transform", "WebkitTransform", "msTransform", "MozTransform", "OTransform"],
		n = {
			transform: ["transition", "transform"],
			WebkitTransform: ["WebkitTransition", "-webkit-transform"],
			msTransform: ["msTransition", "-ms-transform"],
			MozTransform: ["MozTransition", "-moz-transform"],
			OTransform: ["OTransition", "-o-transform"]
		},
		r = e("body")[0],
		i = "transform",
		s = "transition";
		while (p = t.shift()) typeof r.style[p] != "undefined" && (i = p);
		s = n[i],
		window.translate = function(e, t, n) {
			e.style[i] = "translate3d(" + t + "px, " + n + "px, 0)"
		},
		window.translate_transition = function(e, t) {
			e.style[s[0]] = t ? s[1] + " " + t: ""
		}
	})(jQuery);

	var Time = {};
	Time.correction = 0,
	Time.now = function() {
		return Math.round((new Date).getTime() / 1e3) + Time.correction
	},

	Time.BOD = function(e) {
		e || (e = Time.now());
		var t = new Date(e * 1e3);
		return t.setUTCHours(0, 0, 0, 0),
		Math.round(t.getTime() / 1e3)
	};

	var Base64Ajax = function(e, t) {
		var n = function(e) {
			var t = "",
			n, r = new Array(4),
			i = 0,
			s = 0,
			o = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
			while (i < e.length) {
				n = new Array(3);
				for (jnx = 0; jnx < n.length; jnx++) i < e.length ? n[jnx] = e.charCodeAt(i++) & 255 : n[jnx] = 0;
				r[0] = n[0] >> 2,
				r[1] = (n[0] & 3) << 4 | n[1] >> 4,
				r[2] = (n[1] & 15) << 2 | n[2] >> 6,
				r[3] = n[2] & 63,
				s = i - (e.length - 1);
				switch (s) {
				case 2:
					r[3] = 64,
					r[2] = 64;
					break;
				case 1:
					r[3] = 64;
					break;
				default:
				}
				for (jnx = 0; jnx < r.length; jnx++) t += o.charAt(r[jnx])
			}
			return t
		},
		r = function(e) {
			if (typeof Uint8Array == "undefined") return n(e);
			var t = "",
			r = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
			i = new Uint8Array(e),
			s = i.byteLength,
			o = s % 3,
			u = s - o,
			a,
			f,
			l,
			c,
			h;
			for (var p = 0; p < u; p += 3) h = i[p] << 16 | i[p + 1] << 8 | i[p + 2],
			a = (h & 16515072) >> 18,
			f = (h & 258048) >> 12,
			l = (h & 4032) >> 6,
			c = h & 63,
			t += r[a] + r[f] + r[l] + r[c];
			return o == 1 ? (h = i[u], a = (h & 252) >> 2, f = (h & 3) << 4, t += r[a] + r[f] + "==") : o == 2 && (h = i[u] << 8 | i[u + 1], a = (h & 64512) >> 10, f = (h & 1008) >> 4, l = (h & 15) << 2, t += r[a] + r[f] + r[l] + "="),
			t
		},
		i = function(e, t) {
			var n = new XMLHttpRequest;
			return "withCredentials" in n ? n.open("GET", e, !0) : typeof XDomainRequest != "undefined" && (n = new XDomainRequest, n.open("GET", e)),
			typeof n.overrideMimeType != "undefined" && n.overrideMimeType("text/plain; charset=x-user-defined"),
			n.responseType = "arraybuffer",
			n.onload = function(e) {
				var i = e.currentTarget && e.currentTarget.response ? e.currentTarget.response: n.responseText;
				t(r(i))
			},
			n.send(),
			n
		};
		return i(e, t)
	},

	Map = function() {
		function Tt(e, t, n, r, i, s, o, u, a) {
			vt = r - e,
			mt = i - t,
			gt = s - n;
			var f = 1 / Math.sqrt(vt * vt + mt * mt + gt * gt);
			vt *= f,
			mt *= f,
			gt *= f,
			ft = gt * u - mt * a,
			lt = vt * a - gt * o,
			ct = mt * o - vt * u;
			var l = 1 / Math.sqrt(ft * ft + lt * lt + ct * ct);
			ft *= l,
			lt *= l,
			ct *= l,
			ht = gt * lt - mt * ct,
			pt = vt * ct - gt * ft,
			dt = mt * ft - vt * lt,
			yt = -(e * ft + t * lt + n * ct),
			bt = -(e * ht + t * pt + n * dt),
			wt = -(e * vt + t * mt + n * gt)
		}
		function Nt(e, t, n, r, i, s) {
			var o = -(e * r + t * i + n * s),
			u = o * o - (e * e + t * t + n * n) + 1;
			if (u <= 0) return 0;
			var a = o - Math.sqrt(u);
			if (a <= 0) return 0;
			var f = e + r * a,
			l = t + i * a,
			c = n + s * a,
			h = (Math.PI * .5 - Math.acos(l)) * 180 / Math.PI,
			p = Math.atan2(c, f) * 180 / Math.PI;
			return [h, p]
		}
		function Ct(e, t, n, r, i) {
			e *= Math.PI / 180,
			t *= Math.PI / 180,
			n *= Math.PI / 180,
			r *= Math.PI / 180;
			var s = Math.cos(e) * Math.cos(t),
			o = Math.sin(e),
			u = Math.cos(e) * Math.sin(t);
			Et = s + i * Math.cos(e + r) * Math.cos(t + n),
			St = o + i * Math.sin(e + r),
			xt = u + i * Math.cos(e + r) * Math.sin(t + n),
			Tt(Et, St, xt, s, o, u, 0, 1, 0)
		}
		function kt(e, t, n, r) {
			if (z == 3) return Lt(e, t, n);
			var i = e * ft + t * lt + n * ct + yt,
			s = e * ht + t * pt + n * dt + bt,
			o = e * vt + t * mt + n * gt + wt,
			u = S / o;
			return [S * .5 + i * u - (r ? 0 : x), S * .5 + s * u]
		}
		function Lt(e, t, n) {
			var r = e * ft + t * lt + n * ct + yt,
			i = e * ht + t * pt + n * dt + bt,
			s = e * vt + t * mt + n * gt + wt,
			o = E / s,
			u = (S - E) / 2;
			return [E * .5 + r * o, E * .5 + i * o + u]
		}
		function At(e, t, n) {
			return e *= Math.PI / 180,
			t *= Math.PI / 180,
			kt(Math.cos(e) * Math.cos(t), Math.sin(e), Math.cos(e) * Math.sin(t), n)
		}
		function Ot(e, t) {
			var n = 1 / (E - 1),
			r = 1 / (S - 1),
			i = e * n - .5,
			s = t * r - .5,
			o = 1 / Math.sqrt(i * i + s * s + 1);
			return i *= o,
			s *= o,
			Nt(Et, St, xt, i * ft + s * ht + o * vt, i * lt + s * pt + o * mt, i * ct + s * dt + o * gt)
		}
		var e = !0,
		t = !0,
		n = !0,
		r = ENV.is_mozilla,
		s = ENV.is_webkit,
		o = ENV.is_ie,
		u = ENV.is_mobile;
		try {
			new Int32Array
		} catch(a) {
			e = !1
		}
		if (ENV.is_ie && !ENV.is_old_ie || $.browser.safari && +$.browser.version.split(".")[0] < 536) t = !1;
		var f = {};
		window.requestAnimFrame = function() {
			return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
			function(e, t) {
				window.setTimeout(e, 11)
			}
		} ();
		var l = $("#map");
		if (l.length == 0) return null;
		var c = $("#map .map_container"),
		h = $("#map canvas"),
		p = h[0],
		d = p.getContext("2d"),
		v = +h.attr("width"),
		m = +h.attr("height"),
		g = v,
		y = m,
		b = 1,
		w = velocity_offset_y = 0,
		E = h.width(),
		S = h.height(),
		x = 0,
		T = 500,
		N = T,
		C = T,
		k = null,
		L = null,
		A = u ? $("#map_area > .time") : $("#map .top_bar .time span"),
		O = $("#map .controls"),
		M = O.find(".play_button"),
		_ = O.find(".timeline"),
		D = E - O.find(".play_button").width(),
		P = $("#map .slider"),
		H = $("#map .timeline .progress"),
		B = P.width() / 2,
		j = $("#map .levels"),
		F = $("#map .map_container .cities"),
		I = $("#map .map_container .location"),
		q,
		R,
		U,
		z = null,
		W,
		X,
		V,
		J,
		K = 0,
		Q = !1,
		G = !1,
		Y,
		Z,
		et,
		tt = [],
		nt = [],
		rt = [],
		it,
		st,
		ot,
		ut,
		at;
		f.resize = function(e, t, n) {
			e -= 2 * n,
			t -= 2 * n,
			v = g = E = e,
			m = y = S = t;
			if (z == 3) x = 0;
			else {
				var r = At(Y, Z, !0);
				x = Math.max(0, Math.min(S - E, r[0] - E / 2))
			}
			c.css({
				width: e,
				height: t,
				top: n,
				left: n
			}),
			h.attr("width", e).attr("height", t),
			D = E - O.find(".play_button").width(),
			B = P.width() / 2
		};
		var ft, lt, ct, ht, pt, dt, vt, mt, gt, yt, bt, wt, Et, St, xt, Mt = function() {
			var e = z == 0 ? "h:mm": "ddd",
			t = Time.now(),
			n = (t - it) / at;
			if (at == 0 || n < 0) n = 0;
			var r = O.find(".timeline .labels");
			r.html("");
			var i = n * D;
			ENV.is_mobile && (i = Math.round(i) + 3),
			$('<div class="now"></div>').css("left", i).appendTo(r);
			var s = moment(it * 1e3).add("hours", Forecaster.tz_offset_from_local),
			o = moment(st * 1e3).add("hours", Forecaster.tz_offset_from_local);
			z > 0 && s.startOf("day");
			var u, a, f = 0;
			while (s < o) {
				a = (s.unix() - it - 3600 * Forecaster.tz_offset_from_local) / at,
				a >= 0 && (u = $('<div class="tick"></div>').css({
					left: Math.round(a * D)
				}).addClass(f % 2 == 0 ? "even": "odd"), (!ENV.is_mobile || f % 2 == 0) && $('<span class="time"></span>').html(s.format(e)).appendTo(u), u.appendTo(r)),
				z == 0 ? s.add("seconds", 1200) : s.add("days", 1),
				f++
			}
		},
		_t = function(e) {
			if (e) {
				H.show();
				var t = n = D;
				ot = it,
				ut = st
			} else var t = D * (ot - it) / at,
			n = D * (st - ut) / at;
			H.find(".pre").css("width", t),
			H.find(".post").css("width", n)
		},
		Dt = function(e) {
			vn++;
			if (!e && vn % 10 != 0) return;
			var t = moment(hn * 1e3).add("hours", Forecaster.tz_offset_from_local);
			if (z == 0) {
				var n = t.format("h:mma");
				n == "12:NaNam" ? (console.log("NaN on map:", hn, t), A.html("")) : A.html(n)
			} else {
				var r = "";
				hn < K ? hn >= K - 86400 ? r = "Yesterday": r = t.format("[Last] ddd") : hn < K + 86400 ? r = "Today": hn < K + 172800 ? r = "Tomorrow": r = t.format("ddd"),
				A.html(r + " " + t.format("ha"))
			}
		},
		Pt = function() {
			P.set_val(Math.max(0, (hn - it) / at))
		},
		Ht = function(e) {
			yn = !0,
			hn = it + e * at,
			hn < ot ? (hn = ot, Pt()) : hn > ut && (hn = ut, Pt())
		},
		Bt = null,
		jt = !1,
		Ft = !1,
		It = function() {
			if (jt) return;
			jt = !0,
			Ft = !0,
			dn ? f.stop_animation() : Rn(),
			ENV.is_mobile || UIManager.outlook_icons.pause(),
			ENV.is_tablet && (UIManager.overview_icons.pause(), UIManager.stop_wobble())
		},
		qt = function(e) {
			if (!e) {
				var t = Time.now(),
				n = Math.abs(t - hn);
				if (z == 0 && n < 600 || z > 0 && n < 36e3) {
					P.animate_to(Math.max(0, (t - it) / at));
					return
				}
			}
			clearInterval(Bt),
			Bt = null,
			jt = !1,
			Dt(!0),
			rr(),
			Vt(),
			ENV.is_mobile || UIManager.outlook_icons.play(),
			ENV.is_tablet && (UIManager.overview_icons.play(), UIManager.start_wobble())
		},
		Rt = function() {
			qt(!0)
		},
		Ut = [],
		zt = !1,
		Wt = function(e) {
			Ut.push(e),
			Vt()
		},
		Xt = function() {
			if (jt || !Ut.length) {
				zt = !1;
				return
			}
			zt = !0;
			var e = Ut.shift();
			e && e(),
			setTimeout(Xt, 0)
		},
		Vt = function() {
			zt || Xt()
		},
		$t = function(e, t) {
			g = Math.round(e * b),
			y = Math.round(t * b),
			k.prop("width", g).prop("height", y),
			h.prop("width", g).prop("height", y).css({
				width: e,
				height: t
			}),
			q = d.createImageData(g, y),
			U = q.data.length / 4,
			n && (R = new Int32Array(q.data.buffer))
		},
		Jt = function(t) {
			if (t.data.buffer) return new Int32Array(t.data.buffer);
			var n = t.data,
			r = n.length / 4,
			s = e ? new Int32Array(r) : new Array(r);
			for (i = 0; i < r; i++) s[i] = n[4 * i + 3] << 24 | n[4 * i + 2] << 16 | n[4 * i + 1] << 8 | n[4 * i];
			return s
		},
		Kt = function() {
			if (!nt.length) return;
			for (var e = nt.length; e--;) nt[e].i = e;
			it = nt[0].time,
			st = nt[nt.length - 1].time,
			at = st - it
		},
		Qt = function() {
			nt.sort(function(e, t) {
				return e.time - t.time
			}),
			Kt()
		},
		Gt = function(e) {
			if (!e) return;
			var t = (ENV.is_old_ie ? "darkskysatellite/": "http://darkskysatellite.s3.amazonaws.com/") + et.sid + "/" + e + ".png",
			n = {
				time: e,
				loaded: !1,
				src: t,
				velocity: [0, 0],
				dt: null,
				end_x: 0,
				end_y: 0
			};
			return nt.push(n),
			on.push(n),
			n
		},
		Yt = function(e) {
			for (var t = nt.length; t--;) if (nt[t].time == e.time) {
				nt.splice(t, 1);
				break
			}
			var n = rt.indexOf(e.time);
			n >= 0 && rt.splice(n, 1),
			Kt(),
			Zt()
		},
		Zt = function(e) {
			var t = Time.now(),
			n = t - t % J,
			r = n,
			e,
			i = [],
			s = [];
			for (var o = nt.length; o--;) {
				e = nt[o];
				if (e.time >= r) e.loaded ? i.push(e.time) : i = [];
				else {
					if (!e.loaded) break;
					s.push(e.time)
				}
			}
			rt = s.concat(i),
			rt.sort(),
			ot = rt[0],
			ut = rt[rt.length - 1],
			Tn = Sn * nt.length,
			_t(),
			Mt(),
			Pt()
		},
		en = function(t, n) {
			L.clearRect(0, 0, 64, 1),
			L.drawImage(t.img, 0, 0, 64, 1, 0, 0, 64, 1);
			var r = L.getImageData(0, 0, 64, 1).data,
			s = e ? new Int32Array([0, 0]) : new Array([0, 0]);
			for (i = 0; i < 32; i++) r[i * 4] & 1 ? s[0] |= 1 << i: s[0] &= ~ (1 << i),
			r[(i + 32) * 4] & 1 ? s[1] |= 1 << i: s[1] &= ~ (1 << i);
			r = null,
			t.velocity[0] = s[0] / 1e6,
			t.velocity[1] = s[1] / 1e6,
			n()
		},
		tn = function(e, t, n) {
			e.is_finishing_loading = !0,
			t ? (e.end_x = J * t.velocity[0], e.end_y = J * t.velocity[1]) : e.end_x = e.end_y = 0;
			var r = -x;
			L.clearRect(0, 0, g, y),
			L.drawImage(e.img, r + b * w, b * velocity_offset_y, y, y),
			t && L.drawImage(t.img, r + b * (w - J * t.velocity[0]), b * (velocity_offset_y - J * t.velocity[1]), y, y);
			var i = Jt(L.getImageData(0, 0, g, y));
			L.drawImage(e.img, r + b * w, b * velocity_offset_y, y, y),
			e.pixels = Jt(L.getImageData(0, 0, g, y));
			for (var s = U; s--;) e.pixels[s] = e.pixels[s] & 255 | i[s] << 8 & 65280;
			return e.loaded = !0,
			Zt(e),
			i = null,
			e.used_as_first_img = !0,
			e.used_as_second_img && (e.img = null),
			t && (t.used_as_second_img = !0, t.used_as_first_img && (t.img = null)),
			typeof n == "function" ? n(null) : null
		},
		nn = function() {
			var e = nt.length,
			t;
			for (var n = 0; n < e; n++) {
				if (nt[n].loaded || nt[n].is_finishing_loading) continue;
				t = n == e - 1;
				if (nt[n].img_loaded && (t || nt[n + 1].img_loaded)) return tn(nt[n], t ? null: nt[n + 1], nn)
			}
		},
		rn = function(e, n) {
			e.img = new Image,
			e.img.crossOrigin = "anonymous",
			e.img.onerror = function() {
				return Yt(e),
				typeof n == "function" ? n(null) : null
			},
			e.img.onload = function() {
				en(e,
				function() {
					an[0] += e.velocity[0],
					an[1] += e.velocity[1],
					an[2]++,
					!an.finished && an[2] >= (G ? 5 : 2) && (an[0] /= an[2], an[1] /= an[2], an.finished = !0, w = 1.15 * Math.abs(Math.ceil(J * an[0])), velocity_offset_y = 1.15 * Math.abs(Math.ceil(J * an[1])), $t(v + 2 * w, m + 2 * velocity_offset_y)),
					e.img_loaded = !0,
					an.finished && nn(),
					typeof n == "function" && n()
				})
			};
			var r = "";
			Time.now() - e.time > 1200 ? r = e.time: r = Time.now(),
			t ? e.img.src = e.src + "?" + r: Base64Ajax(e.src + "?" + r,
			function(t) {
				e.img.src = "data:image/png;base64," + t
			})
		},
		sn = function(e, n) {
			var r = new Image;
			r.crossOrigin = "anonymous",
			r.onerror = function() {
				return Yt(e),
				typeof n == "function" ? n(null) : null
			},
			r.onload = function() {
				var t = f.is_old_ie ? 100 : 0;
				setTimeout(function() {
					Wt(function() {
						return L.clearRect(0, 0, g, y),
						z == 3 ? L.drawImage(r, 0, 0, N, C, 0, b * x, g, g) : L.drawImage(r, 0, 0, N, C, -b * x, 0, y, y),
						e.pixels = Jt(L.getImageData(0, 0, g, y)),
						e.loaded = !0,
						Zt(e),
						typeof n == "function" ? n(null) : null
					})
				},
				t)
			};
			var i = "";
			Time.now() - e.time > 21600 ? i = e.time: i = Time.now(),
			t ? r.src = e.src + "?" + i: Base64Ajax(e.src + "?" + i,
			function(e) {
				r.src = "data:image/png;base64," + e
			})
		},
		on = [],
		un = function() {
			if (on.length == 0) {
				Zn(!0),
				H.hide(),
				!jt && !dn && Pt(),
				G && Wn && (!jt && !Ft && f.start_animation(), Wn = !1);
				return
			}
			rt.length > 0 && Zn();
			var e = on.shift();
			return z == 0 ? rn(e, un) : sn(e, un)
		},
		an = [0, 0, 0],
		fn = function() {
			_t(!0);
			var e = Time.now(),
			t = e - e % J,
			n = [],
			r = [];
			for (var i = 0; i < X; i++) {
				var s = t + i * J;
				if (s - Time.now() > 3600 * V) break;
				n.push(t + i * J)
			}
			for (var i = 1; i <= W; i++) r.push(t - i * J);
			while (n.length > 0 || r.length > 0) Gt(n.shift()),
			Gt(r.shift());
			Qt(),
			an = [0, 0, 0],
			z != 0 && $t(v, m);
			for (var i = 0; i < 4; i++) un()
		},
		ln = function() {
			var e = Time.now(),
			t = e - e % J,
			n = t + J;
			Gt(t),
			Gt(n),
			Qt(),
			z != 0 && $t(v, m),
			un(),
			un()
		},
		cn = 0,
		hn = null,
		pn = 0,
		dn = !1,
		vn = 0,
		mn,
		gn,
		yn = !1,
		bn = 0,
		wn = 0,
		En = Date.now(),
		Sn,
		xn,
		Tn,
		Nn = function(e, t, n) {
			var r = 0,
			i = [61494528, 111826176, 179463680, 246831890, 314073870, 397501206, 481715218, 582248726, 666331155, 767257366, 867789076, 968321814, 1069181204, 1186556181, 1287154452, 1404594965, 1522232086, 1639607061, 1757047574, 1874488086, 1975085589, 2092526102, -2084934891, -1967494378, -1850053866, -1732613355, -1615172842, -1514444267, -1413846250, -1313248747, -1212519658, -1111856362, -1011127530, -927306986, -843421162, -759469547, -675648746, -608539882, -541431018, -491099370, -440833514, -423990504, -424056037, -424056035, -424121568, -424121565, -424252634, -424252630, -424252626, -424252621, -424252618, -424318150, -424383682, -424383678, -424449210, -424449204, -424514736, -424514731, -424580262, -424645792, -424645788, -424711318, -424776849, -424776844, -424907911, -424907905, -424973437, -424973430, -425038961, -425104492, -425170023, -425235553, -425301084, -425366615, -425366610, -425432141, -425563208, -425563203, -425628734, -425759802, -425825332, -425890865, -425956396, -426021928, -426087461, -426152993, -426284061, -426349594, -426480663, -426546195, -426611729, -426742798, -426808077, -426938890, -427069448, -427134982, -427330820, -427461377, -427591937, -427788033, -427918849, -428114689, -428244993, -428441089, -428637185, -428898561, -429028865, -429290241, -429486081, -429681921, -429877761, -430073345, -430334977, -430530817, -430726657, -430922497, -431118337, -431379713, -431575809, -431771393, -431966977, -432228609, -432358657, -432554497, -432684801, -432815105, -433010945, -433206785, -433337089, -433467393, -433597697, -433728001, -433793025, -433923329, -433988353, -434053121, -434052609, -434052097, -434051585, -434050817, -434050561, -434050049, -434049537, -434049281, -433983233, -433917441, -433785857, -433654785, -433457665, -433260801, -433063937, -432801537, -432604673, -432342273, -432080129, -431752193, -431424257, -431162113, -430899713, -430440961, -430113281, -429785089, -429391873, -428998657, -428605441, -428277761, -427884545, -427556865, -427098113, -426639361, -426246145, -425852929, -425525249, -425066497, -424738817, -424345601, -423952385, -423559169, -423165953, -422772737, -422510593, -422182913, -421855233, -421527553, -421199873, -420937729, -420675585, -420413441, -420216833, -419954689, -419758081, -419627009, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419759361, -420022529, -420285697, -420548865, -420943617, -421272577, -421667329, -422062081, -422522625, -422917377, -423377921, -423838465, -424299009, -424891137, -425285889, -425812225, -426338561, -426930689, -427391233, -427851777, -428443905, -428904705, -429430785, -429957121, -430483457, -431009793, -431470337, -431930881, -432391425, -432851969, -433312513, -433707265, -434102017, -434496769, -434957313, -435220481, -435483649, -435812609];
			for (var s = U; s--;) r = t * (n[s] & 255) + e * (n[s] >> 8),
			R[s] = i[r | 0]
		},
		Cn = function() {
			var e = nt[(hn - it) / J | 0];
			if (!e || !e.loaded) return ! 1;
			var t = e.pixels,
			n = (hn - e.time) / J,
			r = 1 - n;
			return Nn(n, r, t),
			d.putImageData(q, 0, 0),
			s ? p.style["-webkit-transform"] = "translate3d(" + (e.end_x * n - w) + "px, " + (e.end_y * n - velocity_offset_y) + "px, 0)": o ? p.style["-ms-transform"] = "translate(" + (e.end_x * n - w) + "px, " + (e.end_y * n - velocity_offset_y) + "px)": p.style.transform = "translate(" + (e.end_x * n - w) + "px, " + (e.end_y * n - velocity_offset_y) + "px)",
			Dt(),
			!0
		},
		kn = function(e, t, n, r) {
			var i = 0,
			s = 0,
			o = 0,
			u = [61494528, 111826176, 179463680, 246831890, 314073870, 397501206, 481715218, 582248726, 666331155, 767257366, 867789076, 968321814, 1069181204, 1186556181, 1287154452, 1404594965, 1522232086, 1639607061, 1757047574, 1874488086, 1975085589, 2092526102, -2084934891, -1967494378, -1850053866, -1732613355, -1615172842, -1514444267, -1413846250, -1313248747, -1212519658, -1111856362, -1011127530, -927306986, -843421162, -759469547, -675648746, -608539882, -541431018, -491099370, -440833514, -423990504, -424056037, -424056035, -424121568, -424121565, -424252634, -424252630, -424252626, -424252621, -424252618, -424318150, -424383682, -424383678, -424449210, -424449204, -424514736, -424514731, -424580262, -424645792, -424645788, -424711318, -424776849, -424776844, -424907911, -424907905, -424973437, -424973430, -425038961, -425104492, -425170023, -425235553, -425301084, -425366615, -425366610, -425432141, -425563208, -425563203, -425628734, -425759802, -425825332, -425890865, -425956396, -426021928, -426087461, -426152993, -426284061, -426349594, -426480663, -426546195, -426611729, -426742798, -426808077, -426938890, -427069448, -427134982, -427330820, -427461377, -427591937, -427788033, -427918849, -428114689, -428244993, -428441089, -428637185, -428898561, -429028865, -429290241, -429486081, -429681921, -429877761, -430073345, -430334977, -430530817, -430726657, -430922497, -431118337, -431379713, -431575809, -431771393, -431966977, -432228609, -432358657, -432554497, -432684801, -432815105, -433010945, -433206785, -433337089, -433467393, -433597697, -433728001, -433793025, -433923329, -433988353, -434053121, -434052609, -434052097, -434051585, -434050817, -434050561, -434050049, -434049537, -434049281, -433983233, -433917441, -433785857, -433654785, -433457665, -433260801, -433063937, -432801537, -432604673, -432342273, -432080129, -431752193, -431424257, -431162113, -430899713, -430440961, -430113281, -429785089, -429391873, -428998657, -428605441, -428277761, -427884545, -427556865, -427098113, -426639361, -426246145, -425852929, -425525249, -425066497, -424738817, -424345601, -423952385, -423559169, -423165953, -422772737, -422510593, -422182913, -421855233, -421527553, -421199873, -420937729, -420675585, -420413441, -420216833, -419954689, -419758081, -419627009, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419430401, -419759361, -420022529, -420285697, -420548865, -420943617, -421272577, -421667329, -422062081, -422522625, -422917377, -423377921, -423838465, -424299009, -424891137, -425285889, -425812225, -426338561, -426930689, -427391233, -427851777, -428443905, -428904705, -429430785, -429957121, -430483457, -431009793, -431470337, -431930881, -432391425, -432851969, -433312513, -433707265, -434102017, -434496769, -434957313, -435220481, -435483649, -435812609];
			for (var a = U; a--;) i = t * (n[a] & 255) + e * (n[a] >> 8),
			o = u[i | 0],
			s = 4 * a,
			r[s + 3] = o >>> 24,
			r[s + 2] = o >> 16 & 255,
			r[s + 1] = o >> 8 & 255,
			r[s] = o & 255
		},
		Ln = function(e, t, n, r) {
			var i = 0,
			s = 0,
			o = 0,
			u = [3, 2, 1, 0, 6, 4, 2, 0, 10, 7, 4, 0, 14, 10, 5, 1, 18, 13, 7, 1, 23, 16, 9, 2, 28, 20, 11, 2, 34, 24, 14, 3, 39, 28, 16, 3, 45, 33, 19, 4, 51, 37, 21, 4, 57, 41, 24, 5, 63, 46, 26, 5, 70, 51, 29, 6, 76, 55, 32, 6, 83, 60, 35, 7, 90, 66, 38, 8, 97, 71, 41, 8, 104, 76, 44, 9, 111, 81, 47, 10, 117, 85, 49, 10, 124, 90, 52, 11, 131, 96, 55, 11, 138, 101, 58, 12, 145, 106, 61, 13, 152, 111, 64, 13, 159, 116, 67, 14, 165, 121, 69, 14, 171, 125, 72, 15, 177, 128, 74, 15, 183, 133, 77, 16, 189, 138, 79, 16, 195, 143, 82, 17, 200, 146, 84, 17, 205, 150, 85, 18, 210, 154, 87, 17, 215, 157, 90, 19, 219, 160, 92, 19, 223, 163, 94, 19, 226, 165, 95, 19, 229, 166, 95, 20, 230, 168, 97, 22, 230, 167, 97, 24, 230, 167, 97, 26, 230, 166, 97, 29, 230, 166, 97, 32, 230, 164, 97, 34, 230, 164, 97, 38, 230, 164, 97, 41, 230, 164, 97, 46, 230, 164, 97, 49, 230, 163, 97, 52, 230, 162, 97, 56, 230, 162, 97, 60, 230, 161, 97, 63, 230, 161, 97, 69, 230, 161, 97, 72, 230, 161, 97, 77, 230, 160, 97, 81, 230, 159, 97, 87, 230, 159, 97, 90, 230, 158, 97, 96, 230, 157, 97, 100, 230, 157, 97, 105, 230, 155, 97, 109, 230, 155, 97, 115, 230, 154, 97, 118, 230, 154, 97, 124, 230, 153, 97, 129, 230, 152, 97, 133, 230, 152, 97, 138, 230, 151, 97, 143, 230, 150, 97, 148, 230, 149, 97, 152, 230, 149, 97, 157, 230, 148, 97, 161, 230, 146, 97, 166, 230, 146, 97, 170, 230, 145, 97, 175, 230, 143, 97, 179, 230, 143, 97, 184, 230, 142, 97, 187, 230, 141, 97, 191, 230, 140, 97, 195, 230, 139, 97, 198, 230, 138, 97, 201, 230, 136, 97, 205, 230, 135, 97, 207, 230, 133, 97, 210, 230, 133, 97, 214, 230, 132, 97, 216, 230, 130, 97, 218, 230, 129, 97, 219, 230, 127, 98, 222, 230, 125, 100, 224, 230, 124, 100, 225, 230, 122, 103, 227, 230, 120, 105, 230, 230, 118, 106, 230, 230, 115, 108, 230, 230, 114, 109, 230, 230, 111, 112, 230, 230, 109, 115, 230, 230, 106, 116, 230, 230, 104, 118, 230, 230, 100, 121, 230, 230, 98, 124, 230, 230, 95, 126, 230, 230, 92, 129, 230, 230, 89, 132, 230, 230, 87, 134, 230, 230, 84, 138, 230, 230, 80, 140, 230, 230, 78, 143, 230, 230, 75, 145, 230, 230, 72, 148, 230, 230, 69, 151, 230, 230, 66, 153, 230, 230, 63, 155, 230, 230, 60, 159, 230, 230, 58, 162, 230, 230, 54, 164, 230, 230, 52, 168, 230, 230, 50, 170, 230, 230, 48, 173, 230, 230, 46, 176, 230, 230, 43, 179, 230, 230, 41, 181, 230, 230, 39, 184, 230, 230, 37, 187, 230, 230, 35, 189, 230, 230, 33, 192, 230, 230, 32, 194, 230, 230, 31, 197, 230, 230, 30, 198, 230, 230, 29, 201, 230, 230, 29, 203, 230, 230, 29, 205, 230, 230, 29, 207, 230, 230, 29, 209, 230, 230, 29, 210, 230, 230, 29, 212, 230, 230, 29, 214, 230, 230, 29, 215, 230, 230, 30, 216, 230, 230, 31, 217, 230, 230, 32, 219, 230, 230, 34, 219, 230, 230, 37, 221, 230, 230, 40, 222, 230, 230, 42, 223, 230, 230, 46, 224, 230, 230, 49, 225, 230, 230, 52, 225, 230, 230, 56, 225, 230, 230, 60, 226, 230, 230, 65, 227, 230, 230, 69, 227, 230, 230, 72, 228, 230, 230, 78, 228, 230, 230, 83, 228, 230, 230, 87, 230, 230, 230, 93, 230, 230, 230, 98, 230, 230, 230, 104, 230, 230, 230, 108, 230, 230, 230, 114, 230, 230, 230, 118, 230, 230, 230, 124, 230, 230, 230, 131, 230, 230, 230, 136, 230, 230, 230, 142, 230, 230, 230, 146, 230, 230, 230, 152, 230, 230, 230, 157, 230, 230, 230, 162, 230, 230, 230, 168, 230, 230, 230, 173, 230, 230, 230, 179, 230, 230, 230, 184, 230, 230, 230, 188, 230, 230, 230, 192, 230, 230, 230, 197, 230, 230, 230, 201, 230, 230, 230, 206, 230, 230, 230, 209, 230, 230, 230, 213, 230, 230, 230, 216, 230, 230, 230, 219, 230, 230, 230, 223, 230, 230, 230, 225, 230, 230, 230, 227, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 225, 225, 230, 230, 222, 222, 230, 230, 218, 218, 230, 230, 215, 215, 230, 230, 209, 209, 230, 230, 205, 205, 230, 230, 199, 199, 230, 230, 194, 194, 230, 230, 188, 188, 230, 230, 182, 182, 230, 230, 176, 176, 230, 230, 170, 170, 230, 230, 163, 163, 230, 230, 155, 155, 230, 230, 150, 150, 230, 230, 143, 143, 230, 230, 135, 135, 230, 230, 127, 127, 230, 230, 121, 121, 230, 230, 115, 115, 230, 230, 106, 106, 230, 230, 100, 99, 230, 230, 93, 93, 230, 230, 86, 86, 230, 230, 78, 78, 230, 230, 71, 71, 230, 230, 65, 65, 230, 230, 59, 59, 230, 230, 52, 52, 230, 230, 46, 46, 230, 230, 40, 40, 230, 230, 34, 34, 230, 230, 29, 29, 230, 230, 23, 23, 230, 230, 17, 17, 230, 230, 14, 14, 230, 230, 10, 10, 230, 230, 5, 5, 230];
			for (var a = U; a--;) i = t * (n[a] & 255) + e * (n[a] >> 8),
			o = 4 * (i | 0),
			s = 4 * a,
			r[s + 3] = u[o],
			r[s + 2] = u[o + 1],
			r[s + 1] = u[o + 2],
			r[s] = u[o + 3]
		},
		An = function() {
			var e = nt[(hn - it) / J | 0];
			if (!e || !e.loaded) return ! 1;
			var t = e.pixels,
			n = (hn - e.time) / J,
			i = 1 - n;
			return ENV.is_android ? Ln(n, i, t, q.data) : kn(n, i, t, q.data),
			d.putImageData(q, 0, 0),
			s ? p.style["-webkit-transform"] = "translate3d(" + (e.end_x * n - w) + "px, " + (e.end_y * n - velocity_offset_y) + "px, 0)": o ? h.css("-ms-transform", "translate(" + (e.end_x * n - w) + "px, " + (e.end_y * n - velocity_offset_y) + "px)") : r ? h.css("-moz-transform", "translate(" + (e.end_x * n - w) + "px, " + (e.end_y * n - velocity_offset_y) + "px)") : p.style.transform = "translate(" + (e.end_x * n - w) + "px, " + (e.end_y * n - velocity_offset_y) + "px)",
			Dt(),
			!0
		},
		On = function(e, t, n, r, i, s, o, u, a, f, l, c) {
			var h = 0,
			p = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 75448064, 162157824, 245586688, 347232512, 447764480, 565271552, 682776832, 817125888, 951147264, 1085496064, 1219779584, 1354062848, 1504992e3, 1639275520, 1773362176, 1924488448, 2058705664, -2102109184, -1967825920, -1850385152, -1732944640, -1632346880, -1531618048, -1447731968, -1363845888, -1296737024, -1280025598, -1280091129, -1280156660, -1280287983, -1280288490, -1280354021, -1280485344, -1280485849, -1280551379, -1280682956, -1280683461, -1280814526, -1280945846, -1280946350, -1281143207, -1281143710, -1281340566, -1281340815, -1281472390, -1281603455, -1281668984, -1281800047, -1281865575, -1282062176, -1282127703, -1282258768, -1282455369, -1282455362, -1282586426, -1282717491, -1282914094, -1282979623, -1283110689, -1283372827, -1283438359, -1283569425, -1283766029, -1283831561, -1284028166, -1284224001, -1284289281, -1284419585, -1284680961, -1284745985, -1284942081, -1285137921, -1285333761, -1285529345, -1285790721, -1285986305, -1286247169, -1286443009, -1286704129, -1286899713, -1287160833, -1287487233, -1287748097, -1287943937, -1288139009, -1288400129, -1288660993, -1288856577, -1289117441, -1289312769, -1289573889, -1289769473, -1290030081, -1290225665, -1290420993, -1290616577, -1290812161, -1291007745, -1291203073, -1291267329, -1291463169, -1291527681, -1291657473, -1291787777, -1291786753, -1291785729, -1291784961, -1291784193, -1291783425, -1291782657, -1291782145, -1291781377, -1291780865, -1291780097, -1291780097, -1291649025, -1291649025, -1291452417, -1291321345, -1291190273, -1290993665, -1290797057, -1290600449, -1290403841, -1290207233, -1289945089, -1289748481, -1289486337, -1289224193, -1289027585, -1288699905, -1288437761, -1288110081, -1287913473, -1287585793, -1287258113, -1286930433, -1286602753, -1286275073, -1285947393, -1285619713, -1285292033, -1285029889, -1284636673, -1284374529, -1283981313, -1283588097, -1283325953, -1282867201, -1282539521, -1282211841, -1281884161, -1281556481, -1281294337, -1280901121, -1280507905, -1280245761, -1279852545, -1279590401, -1279328257, -1278935041, -1278672897, -1278345217, -1278083073, -1277820929, -1277558785, -1277231105, -1277034497, -1276772353, -1276510209, -1276313601, -1276116993, -1275920385, -1275723777, -1275592705, -1275396097, -1275199489, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275397377, -1275660545, -1275923713, -1276252673, -1276581633, -1276910593, -1277371137, -1277700097, -1278226433, -1278555393, -1279015937, -1279476481, -1280002817, -1280463361, -1280923905, -1281450241, -1282042369, -1282502913, -1283095041, -1283555585, -1284081921, -1284542977, -1285068801, -1285595137, -1286187265, -1286647809, -1287108353, -1287568897, -1288029441, -1288489985, -1288950529, -1289345281, -1289740033, -1290200577, -1290595329, -1290858497, -1291121665, -1291516417];
			for (var d = U; d--;) h = t * (e[d] >> n & 255) + u * (o[d] >> a & 255) + i * (r[d] >> s & 255) + l * (f[d] >> c & 255),
			R[d] = p[h | 0]
		},
		Mn = function() {
			var e = (hn - it) / xn,
			t = Tn - 1,
			n = Math.max(0, e | 0),
			r = n / Sn | 0,
			i = n % Sn,
			s = i * 8,
			o = Math.min(n + 1, t),
			u = o / Sn | 0,
			a = o % Sn,
			f = a * 8,
			l = Math.max(0, n - 1),
			c = l / Sn | 0,
			h = l % Sn,
			p = h * 8,
			v = Math.min(n + 2, t),
			m = v / Sn | 0,
			g = v % Sn,
			y = g * 8,
			b = (nt[r] || {}).pixels,
			w = (nt[u] || {}).pixels,
			E = (nt[c] || {}).pixels,
			S = (nt[m] || {}).pixels;
			if (!b || !w || !E || !S) return ! 1;
			var x = Math.max(0, e - n),
			T = .25 + .25 * (1 - x),
			N = .25 + .25 * x,
			C = .25 * (1 - x),
			k = .25 * x;
			return On(b, T, s, E, C, p, w, N, f, S, k, y),
			d.putImageData(q, 0, 0),
			Dt(),
			!0
		},
		_n = function(e, t, n, r, i, s, o, u, a, f, l, c, h) {
			var p = 0,
			d = 0,
			v = 0,
			m = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 75448064, 162157824, 245586688, 347232512, 447764480, 565271552, 682776832, 817125888, 951147264, 1085496064, 1219779584, 1354062848, 1504992e3, 1639275520, 1773362176, 1924488448, 2058705664, -2102109184, -1967825920, -1850385152, -1732944640, -1632346880, -1531618048, -1447731968, -1363845888, -1296737024, -1280025598, -1280091129, -1280156660, -1280287983, -1280288490, -1280354021, -1280485344, -1280485849, -1280551379, -1280682956, -1280683461, -1280814526, -1280945846, -1280946350, -1281143207, -1281143710, -1281340566, -1281340815, -1281472390, -1281603455, -1281668984, -1281800047, -1281865575, -1282062176, -1282127703, -1282258768, -1282455369, -1282455362, -1282586426, -1282717491, -1282914094, -1282979623, -1283110689, -1283372827, -1283438359, -1283569425, -1283766029, -1283831561, -1284028166, -1284224001, -1284289281, -1284419585, -1284680961, -1284745985, -1284942081, -1285137921, -1285333761, -1285529345, -1285790721, -1285986305, -1286247169, -1286443009, -1286704129, -1286899713, -1287160833, -1287487233, -1287748097, -1287943937, -1288139009, -1288400129, -1288660993, -1288856577, -1289117441, -1289312769, -1289573889, -1289769473, -1290030081, -1290225665, -1290420993, -1290616577, -1290812161, -1291007745, -1291203073, -1291267329, -1291463169, -1291527681, -1291657473, -1291787777, -1291786753, -1291785729, -1291784961, -1291784193, -1291783425, -1291782657, -1291782145, -1291781377, -1291780865, -1291780097, -1291780097, -1291649025, -1291649025, -1291452417, -1291321345, -1291190273, -1290993665, -1290797057, -1290600449, -1290403841, -1290207233, -1289945089, -1289748481, -1289486337, -1289224193, -1289027585, -1288699905, -1288437761, -1288110081, -1287913473, -1287585793, -1287258113, -1286930433, -1286602753, -1286275073, -1285947393, -1285619713, -1285292033, -1285029889, -1284636673, -1284374529, -1283981313, -1283588097, -1283325953, -1282867201, -1282539521, -1282211841, -1281884161, -1281556481, -1281294337, -1280901121, -1280507905, -1280245761, -1279852545, -1279590401, -1279328257, -1278935041, -1278672897, -1278345217, -1278083073, -1277820929, -1277558785, -1277231105, -1277034497, -1276772353, -1276510209, -1276313601, -1276116993, -1275920385, -1275723777, -1275592705, -1275396097, -1275199489, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275397377, -1275660545, -1275923713, -1276252673, -1276581633, -1276910593, -1277371137, -1277700097, -1278226433, -1278555393, -1279015937, -1279476481, -1280002817, -1280463361, -1280923905, -1281450241, -1282042369, -1282502913, -1283095041, -1283555585, -1284081921, -1284542977, -1285068801, -1285595137, -1286187265, -1286647809, -1287108353, -1287568897, -1288029441, -1288489985, -1288950529, -1289345281, -1289740033, -1290200577, -1290595329, -1290858497, -1291121665, -1291516417];
			for (var g = U; g--;) p = t * (e[g] >> n & 255) + u * (o[g] >> a & 255) + i * (r[g] >> s & 255) + l * (f[g] >> c & 255),
			v = m[p | 0],
			d = 4 * g,
			h[d + 3] = v >>> 24,
			h[d + 2] = v >> 16 & 255,
			h[d + 1] = v >> 8 & 255,
			h[d] = v & 255
		},
		Dn = function(e, t, n, r, i, s, o, u, a, f, l, c, h) {
			var p = 0,
			d = 0,
			v = 0,
			m = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 2, 1, 0, 9, 6, 3, 0, 14, 9, 5, 0, 20, 14, 7, 0, 26, 18, 9, 0, 33, 23, 12, 0, 40, 28, 14, 0, 48, 34, 17, 0, 56, 39, 20, 0, 64, 45, 23, 0, 72, 51, 26, 0, 80, 57, 29, 0, 89, 63, 32, 0, 97, 69, 35, 0, 105, 74, 38, 0, 114, 81, 42, 0, 122, 87, 44, 0, 130, 92, 47, 0, 138, 98, 50, 0, 145, 103, 53, 0, 152, 108, 55, 0, 158, 112, 58, 0, 164, 116, 60, 0, 169, 120, 62, 0, 174, 124, 63, 0, 178, 126, 65, 0, 179, 126, 65, 1, 179, 126, 65, 5, 179, 125, 65, 8, 179, 124, 64, 12, 179, 124, 62, 15, 179, 123, 62, 19, 179, 121, 62, 22, 179, 121, 60, 27, 179, 121, 60, 32, 179, 119, 59, 37, 179, 119, 58, 41, 179, 118, 58, 46, 179, 117, 57, 52, 179, 117, 55, 58, 179, 114, 55, 62, 179, 114, 53, 69, 179, 112, 53, 74, 179, 112, 52, 79, 179, 111, 51, 86, 179, 110, 51, 91, 179, 109, 51, 95, 179, 107, 51, 102, 179, 107, 51, 107, 179, 105, 51, 112, 179, 104, 51, 119, 179, 102, 51, 124, 179, 100, 51, 128, 179, 100, 51, 133, 179, 99, 51, 139, 179, 98, 51, 144, 179, 95, 51, 147, 179, 95, 51, 152, 179, 93, 51, 157, 179, 91, 51, 161, 179, 90, 51, 164, 179, 88, 51, 168, 179, 86, 51, 171, 179, 86, 51, 173, 179, 84, 51, 175, 179, 81, 53, 179, 179, 81, 53, 179, 179, 79, 55, 179, 179, 77, 58, 179, 179, 76, 59, 179, 179, 74, 60, 179, 179, 72, 62, 179, 179, 69, 65, 179, 179, 67, 67, 179, 179, 65, 69, 179, 179, 62, 72, 179, 179, 60, 76, 179, 179, 58, 78, 179, 179, 55, 81, 179, 179, 53, 84, 179, 179, 50, 86, 179, 179, 46, 90, 179, 179, 44, 93, 179, 179, 41, 95, 179, 179, 39, 100, 179, 179, 37, 102, 179, 179, 34, 106, 179, 179, 32, 109, 179, 179, 29, 112, 179, 179, 27, 116, 179, 179, 24, 119, 179, 179, 22, 121, 179, 179, 19, 126, 179, 179, 17, 128, 179, 179, 15, 132, 179, 179, 13, 135, 179, 179, 11, 138, 179, 179, 8, 140, 179, 179, 6, 144, 179, 179, 6, 147, 179, 179, 4, 150, 179, 179, 3, 152, 179, 179, 1, 156, 179, 179, 0, 158, 179, 179, 0, 161, 179, 179, 0, 164, 179, 179, 0, 166, 179, 179, 0, 168, 179, 179, 0, 170, 179, 179, 0, 172, 179, 179, 0, 173, 179, 179, 0, 175, 179, 179, 0, 177, 179, 179, 0, 179, 179, 179, 0, 179, 179, 179, 1, 179, 179, 179, 1, 179, 179, 179, 4, 179, 179, 179, 5, 179, 179, 179, 6, 179, 179, 179, 8, 179, 179, 179, 11, 179, 179, 179, 13, 179, 179, 179, 15, 179, 179, 179, 17, 179, 179, 179, 20, 179, 179, 179, 22, 179, 179, 179, 25, 179, 179, 179, 27, 179, 179, 179, 29, 179, 179, 179, 33, 179, 179, 179, 36, 179, 179, 179, 39, 179, 179, 179, 41, 179, 179, 179, 45, 179, 179, 179, 48, 179, 179, 179, 52, 179, 179, 179, 55, 179, 179, 179, 59, 179, 179, 179, 62, 179, 179, 179, 66, 179, 179, 179, 69, 179, 179, 179, 72, 179, 179, 179, 77, 179, 179, 179, 79, 179, 179, 179, 84, 179, 179, 179, 88, 179, 179, 179, 91, 179, 179, 179, 95, 179, 179, 179, 99, 179, 179, 179, 102, 179, 179, 179, 106, 179, 179, 179, 110, 179, 179, 179, 112, 179, 179, 179, 117, 179, 179, 179, 121, 179, 179, 179, 124, 179, 179, 179, 128, 179, 179, 179, 131, 179, 179, 179, 133, 179, 179, 179, 138, 179, 179, 179, 140, 179, 179, 179, 144, 179, 179, 179, 147, 179, 179, 179, 150, 179, 179, 179, 152, 179, 179, 179, 156, 179, 179, 179, 158, 179, 179, 179, 161, 179, 179, 179, 164, 179, 179, 179, 166, 179, 179, 179, 168, 179, 179, 179, 170, 179, 179, 179, 172, 179, 179, 179, 173, 179, 179, 179, 175, 179, 179, 179, 178, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 175, 175, 179, 179, 173, 173, 179, 179, 170, 170, 179, 179, 166, 166, 179, 179, 163, 163, 179, 179, 159, 159, 179, 179, 154, 154, 179, 179, 151, 151, 179, 179, 145, 145, 179, 179, 142, 142, 179, 179, 137, 137, 179, 179, 132, 132, 179, 179, 126, 126, 179, 179, 121, 121, 179, 179, 117, 117, 179, 179, 111, 111, 179, 179, 105, 105, 179, 179, 100, 100, 179, 179, 93, 93, 179, 179, 88, 88, 179, 179, 83, 83, 179, 179, 78, 77, 179, 179, 72, 72, 179, 179, 67, 67, 179, 179, 60, 60, 179, 179, 55, 55, 179, 179, 51, 51, 179, 179, 46, 46, 179, 179, 41, 41, 179, 179, 36, 36, 179, 179, 31, 31, 179, 179, 27, 27, 179, 179, 22, 22, 179, 179, 18, 18, 179, 179, 13, 13, 179, 179, 11, 11, 179, 179, 8, 8, 179, 179, 4, 4, 179];
			for (var g = U; g--;) p = t * (e[g] >> n & 255) + u * (o[g] >> a & 255) + i * (r[g] >> s & 255) + l * (f[g] >> c & 255),
			v = 4 * (p | 0),
			d = 4 * g,
			h[d + 3] = m[v],
			h[d + 2] = m[v + 1],
			h[d + 1] = m[v + 2],
			h[d] = m[v + 3]
		},
		Pn = function() {
			var e = (hn - it) / xn,
			t = Tn - 1,
			n = Math.max(0, e | 0),
			r = n / Sn | 0,
			i = n % Sn,
			s = i * 8,
			o = Math.min(n + 1, t),
			u = o / Sn | 0,
			a = o % Sn,
			f = a * 8,
			l = Math.max(0, n - 1),
			c = l / Sn | 0,
			h = l % Sn,
			p = h * 8,
			v = Math.min(n + 2, t),
			m = v / Sn | 0,
			g = v % Sn,
			y = g * 8,
			b = (nt[r] || {}).pixels,
			w = (nt[u] || {}).pixels,
			E = (nt[c] || {}).pixels,
			S = (nt[m] || {}).pixels;
			if (!b || !w || !E || !S) return ! 1;
			var x = Math.max(0, e - n),
			T = .25 + .25 * (1 - x),
			N = .25 + .25 * x,
			C = .25 * (1 - x),
			k = .25 * x;
			return ENV.is_android ? Dn(b, T, s, E, C, p, w, N, f, S, k, y, q.data) : _n(b, T, s, E, C, p, w, N, f, S, k, y, q.data),
			d.putImageData(q, 0, 0),
			Dt(),
			!0
		},
		Hn = function(e, t, n, r, i, s) {
			var o = 0,
			u = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 75448064, 162157824, 245586688, 347232512, 447764480, 565271552, 682776832, 817125888, 951147264, 1085496064, 1219779584, 1354062848, 1504992e3, 1639275520, 1773362176, 1924488448, 2058705664, -2102109184, -1967825920, -1850385152, -1732944640, -1632346880, -1531618048, -1447731968, -1363845888, -1296737024, -1280025598, -1280091129, -1280156660, -1280287983, -1280288490, -1280354021, -1280485344, -1280485849, -1280551379, -1280682956, -1280683461, -1280814526, -1280945846, -1280946350, -1281143207, -1281143710, -1281340566, -1281340815, -1281472390, -1281603455, -1281668984, -1281800047, -1281865575, -1282062176, -1282127703, -1282258768, -1282455369, -1282455362, -1282586426, -1282717491, -1282914094, -1282979623, -1283110689, -1283372827, -1283438359, -1283569425, -1283766029, -1283831561, -1284028166, -1284224001, -1284289281, -1284419585, -1284680961, -1284745985, -1284942081, -1285137921, -1285333761, -1285529345, -1285790721, -1285986305, -1286247169, -1286443009, -1286704129, -1286899713, -1287160833, -1287487233, -1287748097, -1287943937, -1288139009, -1288400129, -1288660993, -1288856577, -1289117441, -1289312769, -1289573889, -1289769473, -1290030081, -1290225665, -1290420993, -1290616577, -1290812161, -1291007745, -1291203073, -1291267329, -1291463169, -1291527681, -1291657473, -1291787777, -1291786753, -1291785729, -1291784961, -1291784193, -1291783425, -1291782657, -1291782145, -1291781377, -1291780865, -1291780097, -1291780097, -1291649025, -1291649025, -1291452417, -1291321345, -1291190273, -1290993665, -1290797057, -1290600449, -1290403841, -1290207233, -1289945089, -1289748481, -1289486337, -1289224193, -1289027585, -1288699905, -1288437761, -1288110081, -1287913473, -1287585793, -1287258113, -1286930433, -1286602753, -1286275073, -1285947393, -1285619713, -1285292033, -1285029889, -1284636673, -1284374529, -1283981313, -1283588097, -1283325953, -1282867201, -1282539521, -1282211841, -1281884161, -1281556481, -1281294337, -1280901121, -1280507905, -1280245761, -1279852545, -1279590401, -1279328257, -1278935041, -1278672897, -1278345217, -1278083073, -1277820929, -1277558785, -1277231105, -1277034497, -1276772353, -1276510209, -1276313601, -1276116993, -1275920385, -1275723777, -1275592705, -1275396097, -1275199489, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275397377, -1275660545, -1275923713, -1276252673, -1276581633, -1276910593, -1277371137, -1277700097, -1278226433, -1278555393, -1279015937, -1279476481, -1280002817, -1280463361, -1280923905, -1281450241, -1282042369, -1282502913, -1283095041, -1283555585, -1284081921, -1284542977, -1285068801, -1285595137, -1286187265, -1286647809, -1287108353, -1287568897, -1288029441, -1288489985, -1288950529, -1289345281, -1289740033, -1290200577, -1290595329, -1290858497, -1291121665, -1291516417];
			for (var a = U; a--;) o = t * (e[a] >> n & 255) + i * (r[a] >> s & 255),
			R[a] = u[o | 0]
		},
		Bn = function() {
			var e = (hn - it) / xn,
			t = Math.max(0, e | 0),
			n = t / Sn | 0,
			r = t % Sn,
			i = r * 8,
			s = Math.min(t + 1, Tn - 1),
			o = s / Sn | 0,
			u = s % Sn,
			a = u * 8,
			f = nt[n].pixels,
			l = nt[o].pixels;
			if (!f || !l) return ! 1;
			var c = Math.max(0, e - t),
			h = 1 - c;
			return Hn(f, h, i, l, c, a),
			d.putImageData(q, 0, 0),
			Dt(),
			!0
		},
		jn = function(e, t, n, r, i, s, o) {
			var u = 0,
			a = 0,
			f = 0,
			l = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 75448064, 162157824, 245586688, 347232512, 447764480, 565271552, 682776832, 817125888, 951147264, 1085496064, 1219779584, 1354062848, 1504992e3, 1639275520, 1773362176, 1924488448, 2058705664, -2102109184, -1967825920, -1850385152, -1732944640, -1632346880, -1531618048, -1447731968, -1363845888, -1296737024, -1280025598, -1280091129, -1280156660, -1280287983, -1280288490, -1280354021, -1280485344, -1280485849, -1280551379, -1280682956, -1280683461, -1280814526, -1280945846, -1280946350, -1281143207, -1281143710, -1281340566, -1281340815, -1281472390, -1281603455, -1281668984, -1281800047, -1281865575, -1282062176, -1282127703, -1282258768, -1282455369, -1282455362, -1282586426, -1282717491, -1282914094, -1282979623, -1283110689, -1283372827, -1283438359, -1283569425, -1283766029, -1283831561, -1284028166, -1284224001, -1284289281, -1284419585, -1284680961, -1284745985, -1284942081, -1285137921, -1285333761, -1285529345, -1285790721, -1285986305, -1286247169, -1286443009, -1286704129, -1286899713, -1287160833, -1287487233, -1287748097, -1287943937, -1288139009, -1288400129, -1288660993, -1288856577, -1289117441, -1289312769, -1289573889, -1289769473, -1290030081, -1290225665, -1290420993, -1290616577, -1290812161, -1291007745, -1291203073, -1291267329, -1291463169, -1291527681, -1291657473, -1291787777, -1291786753, -1291785729, -1291784961, -1291784193, -1291783425, -1291782657, -1291782145, -1291781377, -1291780865, -1291780097, -1291780097, -1291649025, -1291649025, -1291452417, -1291321345, -1291190273, -1290993665, -1290797057, -1290600449, -1290403841, -1290207233, -1289945089, -1289748481, -1289486337, -1289224193, -1289027585, -1288699905, -1288437761, -1288110081, -1287913473, -1287585793, -1287258113, -1286930433, -1286602753, -1286275073, -1285947393, -1285619713, -1285292033, -1285029889, -1284636673, -1284374529, -1283981313, -1283588097, -1283325953, -1282867201, -1282539521, -1282211841, -1281884161, -1281556481, -1281294337, -1280901121, -1280507905, -1280245761, -1279852545, -1279590401, -1279328257, -1278935041, -1278672897, -1278345217, -1278083073, -1277820929, -1277558785, -1277231105, -1277034497, -1276772353, -1276510209, -1276313601, -1276116993, -1275920385, -1275723777, -1275592705, -1275396097, -1275199489, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275068417, -1275397377, -1275660545, -1275923713, -1276252673, -1276581633, -1276910593, -1277371137, -1277700097, -1278226433, -1278555393, -1279015937, -1279476481, -1280002817, -1280463361, -1280923905, -1281450241, -1282042369, -1282502913, -1283095041, -1283555585, -1284081921, -1284542977, -1285068801, -1285595137, -1286187265, -1286647809, -1287108353, -1287568897, -1288029441, -1288489985, -1288950529, -1289345281, -1289740033, -1290200577, -1290595329, -1290858497, -1291121665, -1291516417];
			for (var c = U; c--;) u = t * (e[c] >> n & 255) + i * (r[c] >> s & 255),
			f = l[u | 0],
			a = 4 * c,
			o[a + 3] = f >>> 24,
			o[a + 2] = f >> 16 & 255,
			o[a + 1] = f >> 8 & 255,
			o[a] = f & 255
		},
		Fn = function(e, t, n, r, i, s, o) {
			var u = 0,
			a = 0,
			f = 0,
			l = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 2, 1, 0, 9, 6, 3, 0, 14, 9, 5, 0, 20, 14, 7, 0, 26, 18, 9, 0, 33, 23, 12, 0, 40, 28, 14, 0, 48, 34, 17, 0, 56, 39, 20, 0, 64, 45, 23, 0, 72, 51, 26, 0, 80, 57, 29, 0, 89, 63, 32, 0, 97, 69, 35, 0, 105, 74, 38, 0, 114, 81, 42, 0, 122, 87, 44, 0, 130, 92, 47, 0, 138, 98, 50, 0, 145, 103, 53, 0, 152, 108, 55, 0, 158, 112, 58, 0, 164, 116, 60, 0, 169, 120, 62, 0, 174, 124, 63, 0, 178, 126, 65, 0, 179, 126, 65, 1, 179, 126, 65, 5, 179, 125, 65, 8, 179, 124, 64, 12, 179, 124, 62, 15, 179, 123, 62, 19, 179, 121, 62, 22, 179, 121, 60, 27, 179, 121, 60, 32, 179, 119, 59, 37, 179, 119, 58, 41, 179, 118, 58, 46, 179, 117, 57, 52, 179, 117, 55, 58, 179, 114, 55, 62, 179, 114, 53, 69, 179, 112, 53, 74, 179, 112, 52, 79, 179, 111, 51, 86, 179, 110, 51, 91, 179, 109, 51, 95, 179, 107, 51, 102, 179, 107, 51, 107, 179, 105, 51, 112, 179, 104, 51, 119, 179, 102, 51, 124, 179, 100, 51, 128, 179, 100, 51, 133, 179, 99, 51, 139, 179, 98, 51, 144, 179, 95, 51, 147, 179, 95, 51, 152, 179, 93, 51, 157, 179, 91, 51, 161, 179, 90, 51, 164, 179, 88, 51, 168, 179, 86, 51, 171, 179, 86, 51, 173, 179, 84, 51, 175, 179, 81, 53, 179, 179, 81, 53, 179, 179, 79, 55, 179, 179, 77, 58, 179, 179, 76, 59, 179, 179, 74, 60, 179, 179, 72, 62, 179, 179, 69, 65, 179, 179, 67, 67, 179, 179, 65, 69, 179, 179, 62, 72, 179, 179, 60, 76, 179, 179, 58, 78, 179, 179, 55, 81, 179, 179, 53, 84, 179, 179, 50, 86, 179, 179, 46, 90, 179, 179, 44, 93, 179, 179, 41, 95, 179, 179, 39, 100, 179, 179, 37, 102, 179, 179, 34, 106, 179, 179, 32, 109, 179, 179, 29, 112, 179, 179, 27, 116, 179, 179, 24, 119, 179, 179, 22, 121, 179, 179, 19, 126, 179, 179, 17, 128, 179, 179, 15, 132, 179, 179, 13, 135, 179, 179, 11, 138, 179, 179, 8, 140, 179, 179, 6, 144, 179, 179, 6, 147, 179, 179, 4, 150, 179, 179, 3, 152, 179, 179, 1, 156, 179, 179, 0, 158, 179, 179, 0, 161, 179, 179, 0, 164, 179, 179, 0, 166, 179, 179, 0, 168, 179, 179, 0, 170, 179, 179, 0, 172, 179, 179, 0, 173, 179, 179, 0, 175, 179, 179, 0, 177, 179, 179, 0, 179, 179, 179, 0, 179, 179, 179, 1, 179, 179, 179, 1, 179, 179, 179, 4, 179, 179, 179, 5, 179, 179, 179, 6, 179, 179, 179, 8, 179, 179, 179, 11, 179, 179, 179, 13, 179, 179, 179, 15, 179, 179, 179, 17, 179, 179, 179, 20, 179, 179, 179, 22, 179, 179, 179, 25, 179, 179, 179, 27, 179, 179, 179, 29, 179, 179, 179, 33, 179, 179, 179, 36, 179, 179, 179, 39, 179, 179, 179, 41, 179, 179, 179, 45, 179, 179, 179, 48, 179, 179, 179, 52, 179, 179, 179, 55, 179, 179, 179, 59, 179, 179, 179, 62, 179, 179, 179, 66, 179, 179, 179, 69, 179, 179, 179, 72, 179, 179, 179, 77, 179, 179, 179, 79, 179, 179, 179, 84, 179, 179, 179, 88, 179, 179, 179, 91, 179, 179, 179, 95, 179, 179, 179, 99, 179, 179, 179, 102, 179, 179, 179, 106, 179, 179, 179, 110, 179, 179, 179, 112, 179, 179, 179, 117, 179, 179, 179, 121, 179, 179, 179, 124, 179, 179, 179, 128, 179, 179, 179, 131, 179, 179, 179, 133, 179, 179, 179, 138, 179, 179, 179, 140, 179, 179, 179, 144, 179, 179, 179, 147, 179, 179, 179, 150, 179, 179, 179, 152, 179, 179, 179, 156, 179, 179, 179, 158, 179, 179, 179, 161, 179, 179, 179, 164, 179, 179, 179, 166, 179, 179, 179, 168, 179, 179, 179, 170, 179, 179, 179, 172, 179, 179, 179, 173, 179, 179, 179, 175, 179, 179, 179, 178, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 175, 175, 179, 179, 173, 173, 179, 179, 170, 170, 179, 179, 166, 166, 179, 179, 163, 163, 179, 179, 159, 159, 179, 179, 154, 154, 179, 179, 151, 151, 179, 179, 145, 145, 179, 179, 142, 142, 179, 179, 137, 137, 179, 179, 132, 132, 179, 179, 126, 126, 179, 179, 121, 121, 179, 179, 117, 117, 179, 179, 111, 111, 179, 179, 105, 105, 179, 179, 100, 100, 179, 179, 93, 93, 179, 179, 88, 88, 179, 179, 83, 83, 179, 179, 78, 77, 179, 179, 72, 72, 179, 179, 67, 67, 179, 179, 60, 60, 179, 179, 55, 55, 179, 179, 51, 51, 179, 179, 46, 46, 179, 179, 41, 41, 179, 179, 36, 36, 179, 179, 31, 31, 179, 179, 27, 27, 179, 179, 22, 22, 179, 179, 18, 18, 179, 179, 13, 13, 179, 179, 11, 11, 179, 179, 8, 8, 179, 179, 4, 4, 179];
			for (var c = U; c--;) u = t * (e[c] >> n & 255) + i * (r[c] >> s & 255),
			f = 4 * (u | 0),
			a = 4 * c,
			o[a + 3] = l[f],
			o[a + 2] = l[f + 1],
			o[a + 1] = l[f + 2],
			o[a] = l[f + 3]
		},
		In = function() {
			var e = (hn - it) / xn,
			t = Math.max(0, e | 0),
			n = t / Sn | 0,
			r = t % Sn,
			i = r * 8,
			s = Math.min(t + 1, Tn - 1),
			o = s / Sn | 0,
			u = s % Sn,
			a = u * 8,
			f = nt[n].pixels,
			l = nt[o].pixels;
			if (!f || !l) return ! 1;
			var c = Math.max(0, e - t),
			h = 1 - c;
			return ENV.is_android ? Fn(f, h, i, l, c, a, q.data) : jn(f, h, i, l, c, a, q.data),
			d.putImageData(q, 0, 0),
			Dt(),
			!0
		},
		qn = function() {},
		Rn = function() {
			if (dn) {
				var e = Date.now(),
				t = (e - cn) / 1e3;
				cn = e,
				hn += t * pn,
				hn > ut && (hn = ot)
			}
			qn(),
			(dn || jt) && requestAnimFrame(Rn)
		},
		Un = function() {
			Pt()
		},
		zn = null,
		Wn = !1;
		f.start_animation = function() {
			if (dn) return;
			if (rt.length < 2) return setTimeout(f.start_animation, 250);
			hn || (hn = ot + 1);
			for (var e = rt.length; e--;) if (hn >= rt[e] && hn < rt[e + 1]) {
				mn = nt[e],
				gn = nt[e + 1];
				break
			}
			z == 0 ? pn = 800 : z == 2 ? pn = 3e4: pn = 6e4,
			dn = !0,
			yn = !0,
			cn = Date.now(),
			Rn(),
			zn = setInterval(Un, 100),
			ENV.is_mobile || UIManager.outlook_icons.pause(),
			ENV.is_tablet && (UIManager.overview_icons.pause(), UIManager.stop_wobble()),
			M.removeClass("playing").addClass("playing")
		},
		f.stop_animation = function() {
			dn = !1,
			M.removeClass("playing").addClass("paused"),
			clearInterval(zn),
			Pt(),
			ENV.is_mobile || UIManager.outlook_icons.play(),
			ENV.is_tablet && (UIManager.overview_icons.play(), UIManager.start_wobble())
		};
		var Xn = function(e) {
			e && (e.preventDefault(), e.stopPropagation()),
			dn ? f.stop_animation() : f.start_animation()
		},
		Vn,
		$n = function() {
			c.css("background", "transparent");
			var e = "";
			ENV.is_retina && (ENV.is_tablet ? e = "_1160": e = "_1000"),
			l.addClass("background_loading");
			var t = "http://darkskysatellitemaps.s3.amazonaws.com/" + et.sid + e + ".png?1",
			n = new Image;
			n.onload = function() {
				c.css("background", "transparent url(" + t + ") " + -x + "px 50% no-repeat").css("background-size", (z == 3 ? E: S) + "px"),
				l.removeClass("background_loading")
			},
			n.src = t,
			Vn && Vn.abort();
			
			Vn = $.ajax({
				url: "http://darkskysatellitemaps.s3.amazonaws.com/" + et.sid + "_cities.js",
				dataType: "jsonp"
			})
		};
		f.load_cities = function(e) {
			F.empty();
			var t;
			for (var n = e.length; n--;) {
				t = e[n];
				var r = At(t[1], t[2]);
				$('<span class="city"></span>').css({
					left: r[0] - 4,
					top: r[1] - 6
				}).addClass("size" + t[3]).html("&#9679;" + t[0]).appendTo(F)
			}
		};
		var Jn = function() {
			var e = At(Y, Z);
			I.css({
				left: e[0] - I.width() / 2,
				top: e[1] - I.height() + 6
			}).show()
		},
		Kn = function(e, t) {
			if (e == z && !t) return ! 0;
			dn && f.stop_animation();
			var n = !1;
			for (var i = 0; i < tt.length; i++) if ( + tt[i].sid[0] == e) {
				n = !0,
				et = tt[i];
				break
			}
			if (!n) return ! 1;
			Ct(et.lat, et.lon, et.theta, et.phi, et.zoom),
			z = e,
			l.removeClass("level0").removeClass("level2").removeClass("level3").addClass("level" + z),
			A.empty(),
			z == 0 ? (W = 18, X = 8, V = 1.5, J = 600) : (W = 9, X = 10, V = 174, J = 64800, Sn = 3, xn = J / Sn);
			if (ENV.is_mobile) {
				if (z == 3) f.resize($(window).width(), $(window).width(), 5),
				$("#map .map_container, #map .global_shadow").css("margin-top", ($("#map_area").height() - c.height() - $("#map .top_bar").height()) / 2);
				else {
					var s = $(window).height() - $("#search_area").height() - $("#map .top_bar").height(),
					o = $(window).width();
					f.resize(o, s, 0),
					c.css("margin-top", 0)
				}
				P.css({
					top: $("#map .top_bar").height() + 1,
					height: $("#map_area").height() - $("#map .top_bar").height()
				})
			}
			return ir(),
			qn = z == 0 ? Cn: G ? Mn: Bn,
			d.clearRect(0, 0, g, y),
			r ? h.css("-moz-transform", "translate(0px, 0px)") : p.style["-webkit-transform"] = "translate3d(0, 0, 0)",
			yn = !1,
			hn = Time.now(),
			j.find("li").removeClass("selected"),
			j.find("li.level" + z).addClass("selected"),
			$n(),
			ENV.is_mobile ? G && fn() : G ? fn() : ln(),
			Jn(),
			!0
		},
		Qn = !1,
		Gn = null,
		Yn = function() {
			Qn = !0,
			$("#map .map_container .loading").show()
		},
		Zn = function(e) {
			if (!Qn) return;
			clearTimeout(Gn);
			if (!nt.length) {
				l.addClass("disabled"),
				$("#map .map_container .loading").hide(),
				$("#map .disabled").show();
				return
			}
			l.removeClass("disabled"),
			$("#map .disabled").hide();
			if (hn < ot || hn > ut) hn = Time.now();
			var t = hn - hn % J,
			n = t + J;
			if (rt.indexOf(t) == -1 || rt.indexOf(n) == -1) {
				if (!e) {
					Gn = setTimeout(Zn, 250);
					return
				}
				hn = ot
			}
			if (!qn()) {
				Gn = setTimeout(Zn, 250);
				return
			}
			Qn = !1,
			Dt(!0),
			Pt(),
			$("#map .map_container .loading").hide()
		},
		er = !1,
		tr = null,
		nr = function() {
			if (ENV.is_mobile) return;
			clearTimeout(tr),
			l.removeClass("hide_controls")
		},
		rr = function() {
			if (ENV.is_mobile || er || dn || jt) return;
			clearTimeout(tr),
			tr = setTimeout(function() {
				l.addClass("hide_controls")
			},
			1e3)
		},
		ir = function() {
			for (var e = 0; e < nt.length; e++) nt[e].img = nt[e].pixels = null;
			Ut = [],
			zt = !1,
			rt = [],
			nt = [],
			on = [],
			it = st = 0,
			ot = ut = 0,
			mn = gn = 0,
			hn = Time.now(),
			Ft = !1,
			Yn()
		},
		sr = function() {
			j.empty();
			if (tt.length <= 1) {
				ENV.is_mobile ? $("#map .top_bar .global").show() : $("#map .top_bar").addClass("only_global"),
				j.hide();
				return
			}
			$("#map .top_bar .global").hide(),
			$("#map .top_bar").removeClass("only_global");
			var e = 80;
			for (var t = 0; t < tt.length; t++)(function(t) {
				var n = +tt[t].sid[0],
				r = n == 0 ? "Local": n == 2 ? "Regional": "Global";
				
				$("<li><a>" + r + "</a></li>").
					css("width", e).
					addClass("level" + n).
					click(function(e) {
						e.stopPropagation(),
						e.preventDefault(),
						Kn(n)
					}).appendTo(j);
					
			})(t);
			var n = 1 + tt.length + tt.length * e,
			r = (l.width() - n) / 2;
			j.css({
				width: n
			}),
			$("#map .top_bar .label, #map .top_bar .time").css("width", r),
			j.find("li").removeClass("selected"),
			z != null && j.find("li.level" + z).addClass("selected"),
			j.show()
		},
		or = false;
		f.initialize = function(e) {
			l.bind("mouseover",
			function() {
				er = true,
				nr()
			}),
			l.bind("mouseout",
			function() {
				er = false,
				rr()
			}),
			!ENV.is_mobile && !ENV.is_tablet && (I.bind("mouseover",
			function() {
				I.addClass("highlighted")
			}), I.bind("mousedown",
			function() {
				I.addClass("highlighted")
			}), I.bind("mouseout",
			function() {
				I.removeClass("highlighted")
			}), I.draggable({
				stop: function(e, t) {
					I.removeClass("highlighted");
					var n = t.position.left + I.width() / 2,
					r = t.position.top + I.height() - 6,
					i = Ot(n, r);
					i ? setTimeout(function() {
						Q = true;
						var e = Ot(n, r);
						e && Router.set_latlon_hash("f", e[0], e[1], null, null, true);
					},
					500) : I.animate({
						top: [t.originalPosition.top, "linear"],
						left: [t.originalPosition.left, "linear"]
					},
					300)
				}
			})),
			$("#map .loading").show(),
			ENV.is_tablet && ($("#map .load_animation").addClass("hidden"), $("#map .load_animation_small").addClass("hidden")),
			k = $("<canvas />"),
			k.css({
				position: "absolute",
				top: -2 * S,
				left: -2 * E
			}),
			k.attr("width", g),
			k.attr("height", y),
			k.appendTo($("body")),
			L = k[0].getContext("2d"),
			n = !!L.createImageData(1, 1).data.buffer,
			n ? ENV.is_iphone ? ENV.is_retina ? b = .725 : b = .5 : ENV.is_webkit && ENV.is_tablet ? ENV.is_retina ? b = .6 : b = .5 : ENV.is_mobile || ENV.is_tablet ? b = .6 : b = 1 : (b = ENV.is_old_ie ? .7 : .7, Cn = An, Mn = Pn, Bn = In),
			ENV.is_mobile || (_.css("width", D), O.find(".play_button").click(Xn)),
			P = new Slider(P, {
				change: Ht,
				start: It,
				stop: qt,
				stop_animating_to: Rt,
				move_on_down: ENV.is_mobile ? false : true,
				max_speed: ENV.is_mobile || ENV.is_tablet ? .2 : .35
			}),
			ENV.is_mobile && (P.bind("touchstart",
			function() {
				$("#map .slider .handle").removeClass("minimized")
			}), P.bind("touchend",
			function() {
				$("#map .slider .handle").addClass("minimized")
			}), P.bind("tap", Xn), $("#map .top_bar").bind("touchmove",
			function(e) {
				e.preventDefault(),
				e.stopPropagation()
			})),
			or = true,
			typeof e == "function" && e()
		};
		var ur;
		return f.set = function(e) {
			clearTimeout(ur);
			if (!or) return setTimeout(function() {
				f.set(e)
			},
			200);
			
			Y = e.latitude,
			Z = e.longitude,
			Time.correction = e.currently.time - Math.round((new Date).getTime() / 1e3);
			var t = new Date(1e3 * Time.now());
			t.setHours(0, 0, 0, 0),
			K = Math.round(t.getTime() / 1e3) + 3600 * Forecaster.tz_offset_from_local;
			var n = e.flags.satellites,
			r = n.length != tt.length,
			i = !1,
			s = [!1, !1, !1, !1];
			for (var o = 0; o < n.length; o++) {
				s[ + n[o].sid[0]] = !0;
				if (!tt[o] || tt[o].sid != n[o].sid) r = !0;
				et && et.sid == n[o].sid && (i = !0)
			}
			var u = null;
			if (r) {
				tt = n,
				sr();
				if (Q && z != null && s[z]) u = z;
				else {
					G = !1,
					l.removeClass("animation_loaded"),
					Wn = !0;
					var a = ENV.is_mobile ? Math.max(0, tt.length - 2) : Math.max(0, tt.length - 1);
					u = +tt[a].sid[0]
				}
				i || Kn(u, !0)
			} (!Q || !i || r && z != u) && Jn(),
			Q = !1
		},
		f.load_animation = function() {
			if (G || !ENV.is_mobile && !nt.length) return;
			$(window).height() < l.height() + l.position().top && $("html, body").animate({
				scrollTop: l.position().top + 10
			},
			250),
			G = !0,
			l.addClass("animation_loaded"),
			Kn(z, !0)
		},
		$("#map .map_container, #map .load_animation, #map .load_animation_small").click(function() {
			G ? Xn() : f.load_animation(),
			ENV.is_tablet && nr()
		}),
		f.images = function() {
			return nt
		},
		f
	} (),

	
	LocationStats = function() {
		var e = {},
		t = function(e, t, n) {
			n(test_data)
		},
		n = function(e) {
			var t = Infinity,
			n = -Infinity,
			r = e.length,
			i = (new Date).getFullYear(),
			s = "Date,Temperature\n",
			o,
			u,
			a,
			f;
			for (y = 0; y < 2; y++) for (var l = 0; l < e.length; l++) o = e[l],
			u = (o.temperatureMax + o.temperatureMin) / 2,
			a = new Date(i, 0, y * r + l),
			s += a + "," + o.temperatureMin + ";" + u + ";" + o.temperatureMax + "\n",
			o.temperatureMin < t && (t = o.temperatureMin),
			o.temperatureMax > n && (n = o.temperatureMax);
			var c = new Dygraph($("#location_stats .plot_container")[0], s, {
				customBars: true,
				valueRange: [t - 10, n + 10],
				fillAlpha: .25,
				strokeWidth: 0,
				showLabelsOnHighlight: false,
				colors: ["rgb(100, 95, 65)"],
				ylabel: "Temperature (F)"
			})
		},
		r = function(e, t) {
			$("<div></div>").addClass("stat").append($("<div></div>").addClass("label").html(e)).append($("<div></div>").addClass("value").html(t)).appendTo($("#location_stats .monthly"))
		},
		i = function(e) {
			$("#location_stats .monthly").empty(),
			e.temperatureMax && (r("Coldest", e.temperatureMax.min[0] + " (avg high: " + Math.round(e.temperatureMax.min[1]) + "&deg;)"), r("Warmest", e.temperatureMax.max[0] + " (avg high: " + Math.round(e.temperatureMax.max[1]) + "&deg;)")),
			e.precipProbability && (r("Most Precip", e.precipProbability.max[0]), r("Least Precip", e.precipProbability.min[0])),
			e.humidity && r("Most Humid", e.humidity.max[0] + " (avg: " + Math.round(100 * e.humidity.max[1]) + "%)"),
			e.cloudCover && (r("Cloudiest", e.cloudCover.max[0]), r("Sunniest", e.cloudCover.min[0])),
			e.windSpeed && r("Windiest", e.windSpeed.max[0] + " (avg: " + Math.round(e.windSpeed.max[1]) + " " + UIManager.speed_units() + ")")
		};
		return e.load = function(e) {
			UIManager.page_loading(),
			t(e.latitude, e.longitude,
			function(e) {
				n(e.days);
				i(e.monthly);
				UIManager.page_loaded("location_stats");
			})
		},
		e
	} ();
	
	var submit_form = function(e, t) {
		var n = ENV.is_mobile ? $("#sidebar #forecast_location_field").val().trim() : $("#search_area .location_field").val().trim(),
		r = t ? "s": "f";
		form_submitted = true,
		ENV.is_mobile && Sidebar.close_sidebar(),
		$("#sidebar #forecast_location_field").blur(),
		$("#search_area .location_field").blur();
		if (!n) {
			return LocationManager.update_current_location( true );
		}
		
		n.toLowerCase() == "current location" ? 
			LocationManager.use_current_location || LocationManager.update_current_location(false) : 
			LocationManager.use_current_location && e == null && LocationManager.update_current_location(!1);
		if (n && n.match(/^[\d\-\.]+\s*,\s*[\d\-\.]+$/) !== null) {
			var i = n.split(",")[0],
			s = n.split(",")[1],
			o = "/" + r + "/" + i + "," + s;
			e != null && (o += "/" + e);
			Router.set_hash(o);
			
		} else if (LocationManager.use_current_location) {
			Router.set_latlon_hash(r, Forecaster.latitude, Forecaster.longitude, null, e);
		}
		else {
			UIManager.page_loading();
			
			if (n == Forecaster.location_str && Forecaster.latitude != null && Forecaster.longitude != null) {
				var u = !window.location.hash.match("#/" + r + "/"),
				a = e != Forecaster.time;
				if (u || a) {
					var o = "/" + r + "/" + Forecaster.latitude + "," + Forecaster.longitude;
					e != null && (o += "/" + e);
					Router.set_hash(o);
				} else {
					Router.reload();
				}
				return;
			}
			
			LocationManager.loc_for_string(
				n,
				function(t) {
					t.name ? 
						$(LocationManager).trigger("new_location_str", t) : 
						(
							LocationManager.loc_for_lat_long(t.lat, t.lon, true),
							Router.set_latlon_hash(r, t.lat, t.lon, t.name, e)
						)
				}
			);
		}
	};
	
	var Router = function() {
		var e = {},
			t = $(e),
			n = true,
			r = false;
		
		/**
		 * hash
		 *
		 */
		e.set_hash = function(e, t) {
			var n,i;
			
			e = e.replace("#", "");
			n = window.location.hash.replace("#", "");
			i = e == n || 
				!e.match("/f/") != !window.location.hash.match("/f/") || 
				e.split("/").length != window.location.hash.split("/").length;
			
			i && UIManager.page_loading();
			
			e == n ? 
				hash_processor(t) : 
				(
					r = t, 
					window.location.hash = e
				);
		};
		

		/**
		 * hash
		 *
		 */
		e.set_latlon_hash = function(t, r, i, s, o, u) {
			var a = "/" + t + "/" + parseFloat(r).toFixed(4) + "," + parseFloat(i).toFixed(4);
			o != null && (a += "/" + o);
			
			s ? 
				(
					$(LocationManager).trigger("new_location_str", {
						name: s,
						lat: +r,
						lon: +i
					}), 
					n = false
				) : 
				n = true;
			
			e.set_hash(a, u);
		};
		
		/**
		 * hash
		 *
		 */
		e.hash_parse = function() {
			var e = window.location.hash,
				t = e.split("/");
			return {
				loc  : t[2],
				time : t[3] ? +t[3] : null
			}
		};
		
		/**
		 * hash
		 *
		 */
		hash_processor = function(e, i) {
			var s = window.location.hash,
				o = s.split("/"),
				u = o[2],
				a = o[3],
				e = e || r,
				r = false,
				f = s.match("#/f/") ? "forecast": "location_stats";
				
			if (f == "forecast" && u && a) {
				var l = u.split(",")[0],
					c = u.split(",")[1];
				$("body").first().removeClass("forecast stats time").addClass("time");
				Forecaster.get_forecast({
						lat: l,
						lon: c,
						time: a
					},
					null, 
					"time_machine"
				);
				
				!form_submitted && 
					n && 
					LocationManager.loc_for_lat_long(l, c, !e);
					
			} else if (u) {
				var l = +u.split(",")[0],
					c = +u.split(",")[1],
					h = store.enabled && store.get("last_location");
				
				h && 
					h.name && 
					l == h.lat && 
					c == h.lon && 
					(
						$(LocationManager).trigger("new_location_str", h), 
						n = false
					);
				
				$("body")
					.first()
					.removeClass("forecast stats time")
					.addClass(f == "forecast" ? "forecast": "stats");
				
				f == "forecast" ? 
					Forecaster.get_forecast({
							lat: l,
							lon: c
						},
						i, 
						"forecast"
					) : 
					LocationStats.load({
						lat: l,
						lon: c
					}),
					!i && 
					!form_submitted && 
					n && 
					LocationManager.loc_for_lat_long(l, c, !e);
			}
			
			form_submitted = false;
			n = true;
			
			t.trigger("load_page", {
				lat  : l,
				lon  : c,
				time : a
			});
		};
		
		e.reload = function( e ) {
			hash_processor(false, e && typeof e != "object");
		};
		
		$(window).bind("hashchange", e.reload);
		
		return  e;
		
	} ();
	

	
	
	
	$(window).load(ENV.begin);
	
	window.applicationCache && 
		(
			window.applicationCache.addEventListener(
				"updateready",
				function(e) {
					console.log("updateready fired"),
					window.applicationCache.status == window.applicationCache.UPDATEREADY ? 
							(
								window.applicationCache.swapCache(), 
								console.log("swapCache called"), 
								$.get("/proxy/app_reload.php",
									function(e) {
										e && 
										e.version != 
										null && 
										store.enabled && 
										e.version != 
										store.get("app_reload_version") ? 
											(
												console.log("cache reload immediately, v:", e.version), 
												store.enabled && 
												store.set("app_reload_version", e.version), 
												window.location.reload()
											) : 
											console.log("cache reload next time, v:", e.version);
											
									})
							) : console.log("Manifest did not change, nothing new");
				},
				false
			), 
		
			window.applicationCache.addEventListener(
				"error",
				function(e) {
					console.log("ERROR updating application cache")
				}
			), 
	
			store.enabled && store.get("app_reload_version") == null && $.get(
					"/proxy/app_reload.php",
					function(e) {
						e && e.version != null && store.enabled && store.set("app_reload_version", e.version)
					}
				)
		);
	
		$(ENV).bind(
			"criteria_met",
			function() {
				ENV.is_mobile && !ENV.is_homescreen && !1 ? UIManager.show_mobile_splash() : Settings.load_settings()
			}
		);

		$(ENV).bind(
			"criteria_failed",
			function(e, t) {
				t == "not_homescreen" ? 
					(
						$("#install").show(), 
						$("body").addClass("install")
					) : 
					UIManager.page_error(t)
			}
		);
		
		$(Settings).bind(
			"settings_loaded",
			function() {
				if ( ENV.is_mobile ) {
					UIManager.setup_mobile();
					$("#time_machine_view").show();
				}
				
				Map.initialize();
				var e = Router.hash_parse();
				
				if ( e.time ) {
					Router.reload();
				} else {
					if ( store.enabled ) {
						if ( store.get("use_current_location") ) {
							LocationManager.update_current_location(!0);
						} else {
							LocationManager.update_current_location(!1);
								ENV.is_mobile || !window.location.hash || window.location.hash == "#" || 
											window.location.hash == "#/" ? 
											LocationManager.blank_load() : 
											Router.reload()
						}
					}

				}
				
					
				$("#sidebar").show();
			}
		);
		
		$(UIManager).bind(
			"forecast_clicked",
			function(e, t) {
				$("#saved_forecasts .saved_forecast").removeClass("selected");
				t.elem.addClass("selected");
				ENV.is_mobile && Sidebar.close_sidebar();
				Router.set_latlon_hash("f", t.lat, t.lon, t.name);
			}
		);
	
		$(LocationManager).bind(
			"new_location_str",
			function(e, t) {
				LocationManager.save_last_location(t);
				$("#current_location").text(t.name);
				ENV.is_mobile ? 
					$("#search_area .location_field").html(t.name) : 
					$("#search_area .location_field").val(t.name);
				$("#sidebar #forecast_location_field").val(t.name);
			}
		);
		$("#current_location_entry").on(
			"click",
			function() {
				ENV.is_mobile && Sidebar.close_sidebar();
				LocationManager.update_current_location(true);
			}
		);
		$(LocationManager).bind(
			"location_updated",
			function(e, t) {
				$("#saved_forecasts .saved_forecast").removeClass("selected");
				if (Forecaster.latitude == t.lat && Forecaster.longitude == t.lon) {
					return Router.reload();
				}
				t.name && $(LocationManager).trigger("new_location_str", t),
				Router.set_latlon_hash("f", t.lat, t.lon, t.name);
			}
		);
	
		$(Forecaster).bind("requesting_forecast", UIManager.show_loading_screen);
		
		$(Forecaster).bind(
			"forecast_loaded",
			function(e, t) {

				UIManager.set_forecast(t);
				setTimeout(
					function() {
						$("#search_area .refresh").removeClass("loading");
					},
					500
				)
			}
		);
	
		$(Forecaster).bind(
			"forecast_loaded",
			function(e, t) {
				Map.set(t);
			}
		);
		
		$(Forecaster).bind(
			"time_forecast_loaded",
			function(e, t) {
				UIManager.build_time_machine(t);
				setTimeout(
					function() {
						$("#search_area .refresh").removeClass("loading");
					},
					500
				)
			}
		);
	
		$(Forecaster).bind(
			"current_conditions_loaded",
			function(e, t) {}
		);
		
		$("#edit_locations_button, #edit_forecasts_button").on(
			"click",
			function() {
				if ($(this).hasClass("disabled")) {
					return;
				}
				UIManager.toggle_forecast_editing();
			}
		);
	
		$("#done_forecasts_button").on("click", UIManager.exit_forecast_editing);
		
		$(Sidebar).bind("finished_closing_sidebar started_opening_sidebar started_hiding_sidebar", UIManager.exit_forecast_editing);
		
		$(".saved_forecast.editable .delete_button").on(
			"click",
			function(e) {
				event.preventDefault();
				$(this).parents(".saved_forecast.editable").first().toggleClass("deleting");
				return false;
			}
		);
	
		$(Forecaster).bind(
			"invalid_forecast",
			function(e) {
				UIManager.page_error("forecast");
			}
		);

		$(Forecaster).bind(
			"invalid_time_forecast",
			function(e) {
				UIManager.page_error("time_machine");
			}
		);

	
	var form_submitted = false;
	
	$("#sidebar #forecast_location_field").click(
		function() {
			$(this).select();
		}
	);
	
	$("#search_area .location_field").bind(
		"focus",
		function() {
			var e = $(this);
			setTimeout(
				function() {
					e.select();
				},
				0
			);
		}
	);
	


	$("#search_area .buttons .forecast").click(
		function() {
			submit_form();
		}
	);
	
	$("#sidebar #forecast_form").submit(
		function(e) {
			e.preventDefault();
			ENV.is_mobile ? 
				$("#search_area .location_field").html($("#sidebar #forecast_location_field").val()) : 
				$("#search_area .location_field").val($("#sidebar #forecast_location_field").val()),
				submit_form(),
				Sidebar.close_sidebar();
			return false;
		}
	);

	$("#search_area .location_field").keydown(
		function(e) {
			e.which == 13 && submit_form();
		}
	);
	
	$("#search_area .submit_button").click(
		function() {
			submit_form();
		}
	);
	
	$("#search_area .buttons .stats").click(
		function() {
			submit_form(null, true);
		}
	);
	
	$("#add_location_button").click(LocationManager.add_location);
	
	$("#search_area .buttons .time_machine_modal .time_submit").click(
		function() {
			$(UIManager).trigger("time_chosen");
		}
	);
	
	$("#search_area .buttons .time_machine_modal .time_field").keydown(
		function(e) {
			e.which == 13 && $(UIManager).trigger("time_chosen");
		}
	);
	
	$(UIManager).bind(
		"time_chosen",
		function(e) {
			var t = $("#search_area .buttons .time_machine_modal .time_field").val(),
				n = Date.parseFancy(t);
				
			if (!n) {
				 $("#search_area .buttons .time_machine_modal .error").fadeIn(100);
			} else {
				var r = moment(n).startOf("day").add("hours", 12 - Forecaster.tz_offset_from_local);
				submit_form(r.unix());
			}
		}
	);
	
	$(Router).bind(
		"load_page",
		function(e, t) {
			$("#error").hide();
			
			!ENV.is_mobile && 
				UIManager.toggle_time_machine_modal && 
				UIManager.toggle_time_machine_modal( false );
				
			UIManager.hide_day_panel();
		}
	);
	
	$(Forecaster).bind(
		"time_forecast_loaded",
		function(e, t) {
			if ( !t.currently ){
				return;
			}
			$("#search_area .buttons .time_machine_modal .time_field").val(
				moment(1e3 * t.currently.time).
				add("hours", Forecaster.tz_offset_from_local).
				format("MMMM D, YYYY")
			);
		}
	);